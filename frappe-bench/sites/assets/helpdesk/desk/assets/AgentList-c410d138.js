import{_ as k}from"./plus-3ad50efe.js";import{an as C,D as E,al as Q,b7 as S,v as I,z as h,o as d,i as f,g as a,b8 as A,w as i,B as _,f as r,e as y,S as w,ai as T,F as V,r as $,q as b,d as B,a6 as D,h as g,ax as F,a9 as N}from"./index-a86022ab.js";import{_ as R}from"./Avatar.vue_vue_type_script_setup_true_lang-f38fd5a3.js";import{c as L}from"./listManager-63aba0ed.js";import{u as P,_ as z}from"./LV.vue_vue_type_script_setup_true_lang-23701244.js";import{_ as H}from"./PageTitle.vue_vue_type_script_setup_true_lang-022e67c2.js";import"./vuedraggable.umd-9334f31c.js";import"./iconify-6a43d462.js";import"./EmptyMessage.vue_vue_type_script_setup_true_lang-123dde9f.js";import"./TabButtons-ea997705.js";import"./label-fe9568ec.js";import"./error-90c51c34.js";const M={name:"AddNewAgentsDialog",props:["show"],components:{Dialog:E,Input:Q,FeatherIcon:S},setup(){const t=I(""),e=I([]),u=I(!1);return{searchInput:t,inviteQueue:e,currentInputIsValidEmail:u}},methods:{testEmailRegex(t){return/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(t)},onSearchInputChange(t){if(t=t.replaceAll(" ",""),t==""){document.getElementById("searchInput").value="";return}const e=t,u=t.split(",");let s=!1;this.currentInputIsValidEmail=!1,u.forEach(p=>{this.testEmailRegex(p)&&(u.length>1?(this.addToInviteQueue(p),s=!0):e.includes(",")?(this.addToInviteQueue(p),s=!0):this.currentInputIsValidEmail=!0)}),s&&this.clearSearchInput()},addToInviteQueue(t){this.inviteQueue=[...new Set([...this.inviteQueue,t])]},removeEmailFromQueue(t){this.inviteQueue=this.inviteQueue.filter(e=>e!==t)},removeAllEmailFromQueue(){this.inviteQueue=[]},clearSearchInput(){this.currentInputIsValidEmail=!1,this.searchInput="";const t=document.getElementById("searchInput");t.value="",t.focus()},close(){this.searchInput="",this.inviteQueue=[],this.$emit("close")},sentInvites(){this.$resources.sentInvites.submit({emails:this.inviteQueue})}},resources:{sentInvites(){return{url:"helpdesk.api.agent.sent_invites",onSuccess:t=>{this.currentInputIsValidEmail=!1,this.searchInput="",this.inviteQueue=[],this.$toast({title:"Invites Sent Successfully!",icon:"check",iconClasses:"text-green-500"}),this.close()},onError:t=>{t.exc_type=="PaywallReachedError"?this.$toast({title:"Paywall Reached!",text:"You have reached the maximum number of agents you can add. Please upgrade your plan to add more agents.",icon:"x",iconClasses:"text-red-500"}):this.$toast({title:"Error Sending Invites!",icon:"x",iconClasses:"text-red-500"})}}}}},U={class:"space-y-3"},j={key:0,class:"flex max-h-[300px] min-h-[100px] flex-col overflow-y-auto rounded border bg-gray-100 px-2"},q={class:"flex flex-wrap gap-2 py-2"},G=["title"],K={class:"ml-2 text-base"},O=["onClick"],Y={class:"grow"};function J(t,e,u,s,p,l){const v=h("Input"),o=h("Button"),c=h("FeatherIcon"),x=h("Dialog");return d(),f("div",null,[a(x,{options:{title:"Add Agents"},show:u.show,onClose:e[7]||(e[7]=n=>l.close())},A({"body-content":i(()=>[r("div",U,[r("form",{onSubmit:e[3]||(e[3]=T((...n)=>t.onSubmit&&t.onSubmit(...n),["prevent"])),class:"flex flex-row items-center space-x-2"},[a(v,{id:"searchInput",class:"w-full",type:"text",modelValue:s.searchInput,"onUpdate:modelValue":e[0]||(e[0]=n=>s.searchInput=n),placeholder:"Type emails",onInput:e[1]||(e[1]=n=>l.onSearchInputChange(n))},null,8,["modelValue"]),a(o,{appearance:"primary",type:"submit",disabled:!s.currentInputIsValidEmail,onClick:e[2]||(e[2]=()=>{l.addToInviteQueue(s.searchInput),l.clearSearchInput()})},{default:i(()=>[_(" Add ")]),_:1},8,["disabled"])],32),s.inviteQueue.length?(d(),f("div",j,[r("ul",q,[(d(!0),f(V,null,$(s.inviteQueue.slice().reverse(),n=>(d(),f("li",{class:"flex items-center space-x-2 rounded bg-white p-1 shadow",key:n,title:n},[r("span",K,b(n),1),r("button",{class:"grid h-4 w-4 place-items-center rounded text-gray-700 hover:bg-gray-300",onClick:m=>l.removeEmailFromQueue(n)},[a(c,{class:"w-3",name:"x"})],8,O)],8,G))),128))])])):w("",!0)])]),_:2},[s.inviteQueue.length?{name:"actions",fn:i(()=>[a(o,{disabled:s.inviteQueue.length==0,appearance:"primary",onClick:e[4]||(e[4]=n=>l.sentInvites()),class:"mr-2",loading:t.$resources.sentInvites.loading},{default:i(()=>[_("Send Invites")]),_:1},8,["disabled","loading"]),a(o,{appearance:"secondary",class:"mr-2",onClick:e[5]||(e[5]=n=>l.close())},{default:i(()=>[_("Cancel")]),_:1}),r("div",Y,[s.inviteQueue.length>1?(d(),y(o,{key:0,onClick:e[6]||(e[6]=n=>l.removeAllEmailFromQueue())},{default:i(()=>[_(" Clear All ")]),_:1})):w("",!0)])]),key:"0"}:void 0]),1032,["show"])])}const W=C(M,[["render",J]]),X={class:"flex flex-col"},Z={class:"flex items-center justify-between"},ee={class:"flex items-center gap-2"},te={class:"line-clamp-1"},se=["onClick"],_e=B({__name:"AgentList",setup(t){const{apply:e,storage:u}=P("HD Ticket"),s=I(!1),p=[{label:"Name",key:"name",width:"w-80"},{label:"Email",key:"email",width:"w-80"},{label:"Username",key:"username",width:"w-80"}],l=L({doctype:"HD Agent",fields:["name","is_active","user.full_name","user.user_image","user.email","user.username"],filters:{is_active:"1"},auto:!0,transform:o=>{for(const c of o)c.onClick=()=>v(c.name);return o}});D(()=>({title:"Agents"}));function v(o){u.value.clear(),u.value.add({fieldname:"_assign",operator:"is",value:o}),e({name:F})}return(o,c)=>{const x=k,n=h("Button");return d(),f("div",X,[a(H,{title:"Agents"},{right:i(()=>[a(n,{label:"New agent",theme:"gray",variant:"solid",onClick:c[0]||(c[0]=m=>s.value=!s.value)},{prefix:i(()=>[a(x,{class:"h-4 w-4"})]),_:1})]),_:1}),a(g(z),{columns:p,resource:g(l),class:"mt-2.5",doctype:"HD Agent"},{name:i(({data:m})=>[r("div",Z,[r("div",ee,[a(g(R),{label:m.name,image:m.user_image,size:"sm"},null,8,["label","image"]),r("div",te,b(m.full_name),1)]),m.is_active?w("",!0):(d(),y(g(N),{key:0,size:"md",theme:"orange",variant:"subtle"},{default:i(()=>[_("Inactive")]),_:1}))])]),"row-extra":i(({data:m})=>[r("div",{class:"cursor-pointer text-xs",onClick:ne=>v(m.name)}," Tickets â†’ ",8,se)]),_:1},8,["resource"]),a(W,{show:s.value,onClose:c[1]||(c[1]=m=>s.value=!1)},null,8,["show"])])}}});export{_e as default};
//# sourceMappingURL=AgentList-c410d138.js.map
