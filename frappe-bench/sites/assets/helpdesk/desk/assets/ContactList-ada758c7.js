import{_ as K}from"./plus-3ad50efe.js";import{aj as T,c as W,N as w,d as P,v as b,E as j,z as L,o as C,i as I,g as c,w as N,f as m,F as z,r as G,h as r,W as E,bl as F,q as R,e as k,al as M,bm as O,bn as Q,D as A,P as X,be as Y,I as Z,S as H,a6 as ee}from"./index-a86022ab.js";import{_ as J}from"./Avatar.vue_vue_type_script_setup_true_lang-f38fd5a3.js";import{c as te}from"./listManager-63aba0ed.js";import{_ as ae}from"./PageTitle.vue_vue_type_script_setup_true_lang-022e67c2.js";import"./vuedraggable.umd-9334f31c.js";import{_ as oe}from"./LV.vue_vue_type_script_setup_true_lang-23701244.js";import"./iconify-6a43d462.js";import{F as le}from"./FileUploader-c45cb8d3.js";import{_ as ne}from"./Pill-e8642e27.js";import"./EmptyMessage.vue_vue_type_script_setup_true_lang-123dde9f.js";import"./TabButtons-ea997705.js";import"./label-fe9568ec.js";import"./error-90c51c34.js";import"./x-948a4c6e.js";const se=T("contact",()=>{const V=W({doctype:"Contact",fields:["*"],auto:!0,pageLength:99999});return{options:w(()=>V.list?.data||[])}}),ie={class:"space-y-4"},re={class:"mb-2 block text-sm leading-4 text-gray-700"},ue={class:"flex justify-end space-x-2"},ce=P({__name:"NewContactDialog",props:{modelValue:{type:Boolean}},emits:["update:modelValue","close","contactCreated"],setup(V,{emit:p}){const u=V,v=p,f=se(),e=b({emailID:"",firstName:"",lastName:"",phone:"",selectedCustomer:""}),n=b({emailValidationError:"",firstNameValidationError:"",lastNameValidationError:"",phoneValidationError:"",customerValidationError:""}),s=[{label:"Email Id",value:"emailID",error:"emailValidationError",type:"input",action:()=>a(e.value.emailID)},{label:"First Name",value:"firstName",error:"firstNameValidationError",type:"input",action:()=>l(e.value.firstName)},{label:"Last Name",value:"lastName",error:"lastNameValidationError",type:"input"},{label:"Phone",value:"phone",error:"phoneValidationError",type:"input",action:()=>D(e.value.phone)},{label:"Customer",value:"selectedCustomer",error:"customerValidationError",type:"autocomplete",action:()=>h(e.value.selectedCustomer)}],_=w({get:()=>u.modelValue,set:t=>{v("update:modelValue",t),t||v("close")}}),i=j({url:"helpdesk.extends.client.get_list",params:{doctype:"HD Customer",fields:["name","customer_name"]},transform:t=>t.map(U=>({label:U.name,value:U.customer_name})),auto:!0}),o=j({url:"frappe.client.insert",onSuccess:()=>{e.value={emailID:"",firstName:"",lastName:"",phone:"",selectedCustomer:""},E({title:"Contact Created Successfully ",icon:"check",iconClasses:"text-green-600"}),v("contactCreated")},onError:t=>{E({title:"Contact Creation Failed",message:t.message,icon:"error",iconClasses:"text-red-600"})}});function x(){if(g())return;let t={doctype:"Contact",first_name:e.value.firstName,last_name:e.value.lastName,email_ids:[{email_id:e.value.emailID,is_primary:!0}],links:[{link_doctype:"HD Customer",link_name:e.value.selectedCustomer}],phone_nos:[]};e.value.phone&&(t.phone_nos=[{phone:e.value.phone}]),o.submit({doc:t})}function $(t){t&&(e.value.selectedCustomer=t.value)}function g(){let t=a(e.value.emailID);return t+=l(e.value.firstName),t+=D(e.value.phone),t+=h(e.value.selectedCustomer),t}function a(t){n.value.emailValidationError="";const y=F.string().email().safeParse(t).success;return t?y?B(f.options).includes(t)&&(n.value.emailValidationError="Contact with email already exists"):n.value.emailValidationError="Enter a valid email":n.value.emailValidationError="Email should not be empty",n.value.emailValidationError}function l(t){return n.value.firstNameValidationError="",(!t||t.trim()==="")&&(n.value.firstNameValidationError="First name should not be empty"),n.value.firstNameValidationError}function D(t){return n.value.phoneValidationError="",t&&(!/[0-9]+/.test(t)||t.length<10)&&(n.value.phoneValidationError="Enter a valid phone number"),n.value.phoneValidationError}function h(t){return n.value.customerValidationError="",(!t||t.trim()==="")&&(n.value.customerValidationError="Customer should not be empty"),n.value.customerValidationError}function B(t){return t.map(y=>y.email_id)}return(t,y)=>{const U=L("Button");return C(),I("div",null,[c(r(A),{modelValue:_.value,"onUpdate:modelValue":y[1]||(y[1]=d=>_.value=d),options:{title:"Create New Contact"}},{"body-content":N(()=>[m("div",ie,[(C(),I(z,null,G(s,d=>m("div",{key:d.label,class:"flex flex-col gap-1"},[m("span",re,R(d.label),1),d.type==="input"?(C(),k(r(M),{key:0,modelValue:e.value[d.value],"onUpdate:modelValue":S=>e.value[d.value]=S,type:"text",onBlur:d.action},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(C(),k(r(O),{key:1,modelValue:e.value[d.value],"onUpdate:modelValue":[S=>e.value[d.value]=S,$],options:r(i).data,value:e.value[d.value]},null,8,["modelValue","onUpdate:modelValue","options","value"])),c(r(Q),{message:n.value[d.error]},null,8,["message"])])),64)),m("div",ue,[c(U,{label:"Create",loading:r(o).loading,theme:"gray",variant:"solid",onClick:y[0]||(y[0]=d=>x())},null,8,["loading"])])])]),_:1},8,["modelValue"])])}}}),me={class:"flex flex-wrap gap-2 rounded-lg bg-gray-100 p-2"},q=P({__name:"MultiSelect",props:{items:{type:Array,required:!0},placeholder:{type:String,required:!1,default:"Type..."},validate:{type:Function,required:!1,default:()=>!1}},emits:["update:items"],setup(V,{emit:p}){const u=V,v=p,{items:f}=X(u),e=b("");function n(_){const i=u.validate(_);if(i){E({title:i,icon:"x",iconClasses:"text-red-500"});return}const o=[...f.value,_];v("update:items",o),e.value=""}function s(_){const i=f.value.filter(o=>o.value!==_);v("update:items",i)}return(_,i)=>(C(),I("div",me,[(C(!0),I(z,null,G(r(f),o=>(C(),k(ne,{key:o.value,label:o.label,onClick:i[0]||(i[0]=x=>s(x))},null,8,["label"]))),128)),c(r(M),{modelValue:e.value,"onUpdate:modelValue":i[1]||(i[1]=o=>e.value=o),class:"w-full",placeholder:V.placeholder,onKeyup:i[2]||(i[2]=Y(o=>n({label:e.value,value:e.value}),["enter"]))},null,8,["modelValue","placeholder"])]))}}),de={class:"flex flex-col items-center gap-4 p-6"},pe={class:"text-xl font-medium text-gray-900"},ve={class:"flex gap-2"},fe={class:"w-full space-y-2 text-sm text-gray-700"},_e={class:"space-y-1"},ge=m("div",{class:"text-xs"},"Emails",-1),he={class:"space-y-1"},Ce=m("div",{class:"text-xs"},"Phone Nos",-1),ye=P({__name:"ContactDialog",props:{name:{}},emits:["contactUpdated"],setup(V,{emit:p}){const u=V,v=p,f=b(!1),e=w({get(){return(s.doc?.email_ids||[]).map(l=>({label:l.email_id,value:l.email_id}))},set(a){if(a.length===0){E({title:"At least one email is required",icon:"x",iconClasses:"text-red-600"});return}a.length!==s.doc.email_ids.length&&(f.value=!0),s.doc.email_ids=a.map(l=>({email_id:l.value}))}}),n=w({get(){return(s.doc?.phone_nos||[]).map(l=>({label:l.phone,value:l.phone}))},set(a){a.length!==s.doc.phone_nos.length&&(f.value=!0),s.doc.phone_nos=a.map(l=>({phone:l.value}))}}),s=Z({doctype:"Contact",name:u.name,cache:[`contact-${u.name}`,u.name],auto:!0,setValue:{onSuccess(){v("contactUpdated")},onError(){}}}),_=w(()=>({title:s.doc?.name,actions:[{label:"Save",theme:"gray",variant:"solid",onClick:()=>i()}]}));function i(){if(!f.value){E({title:"No changes to save",icon:"x",iconClasses:"text-red-600"});return}s.setValue.submit({email_ids:e.value.map(a=>({email_id:a.value,is_primary:a.value===s.doc.email_id})),phone_nos:n.value.map(a=>({phone:a.value,is_primary_phone:a.value===s.doc.phone,is_primary_mobile:a.value===s.doc.phone}))})}function o(a){s.setValue.submit({image:a?.file_url||null}),f.value=!0}function x(a){if(!F.string().email().safeParse(a.value).success)return"Invalid email"}function $(a){if(!F.string().regex(/^\+[1-9]\d{1,14}$/).min(10).max(15).safeParse(a.value).success)return"Invalid phone number"}function g(a){let l=a.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(l))return E({title:"Invalid file type, only PNG and JPG images are allowed",icon:"x",iconClasses:"text-red-600"}),"Invalid file type, only PNG and JPG images are allowed"}return(a,l)=>{const D=L("Button");return C(),k(r(A),{options:_.value},{"body-main":N(()=>[m("div",de,[m("div",pe,R(r(s).doc?.name),1),c(r(J),{size:"2xl",label:r(s).doc?.name,image:r(s).doc?.image,class:"cursor-pointer hover:opacity-80"},null,8,["label","image"]),m("div",ve,[c(r(le),{"validate-file":g,onSuccess:l[0]||(l[0]=h=>o(h))},{default:N(({uploading:h,openFileSelector:B})=>[c(D,{label:r(s).doc?.image?"Change photo":"Upload photo",loading:h,onClick:B},null,8,["label","loading","onClick"])]),_:1}),r(s).doc?.image?(C(),k(D,{key:0,label:"Remove photo",onClick:l[1]||(l[1]=h=>o(null))})):H("",!0)]),m("div",fe,[m("div",_e,[ge,c(q,{items:e.value,"onUpdate:items":l[2]||(l[2]=h=>e.value=h),placeholder:"john.doe@example.com",validate:x},null,8,["items"])]),m("div",he,[Ce,c(q,{items:n.value,"onUpdate:items":l[3]||(l[3]=h=>n.value=h),placeholder:"+91 98765 43210",validate:$},null,8,["items"])])])])]),_:1},8,["options"])}}}),Ve={class:"flex flex-col"},xe={class:"flex items-center gap-2"},be={class:"line-clamp-1"},qe=P({__name:"ContactList",setup(V){const p=b(!1),u=b(!1),v=b(null),f=[{label:"Name",key:"name",width:"w-80"},{label:"Email",key:"email_id",width:"w-80"},{label:"Phone",key:"phone",width:"w-80"}],e=te({doctype:"Contact",fields:["name","email_id","image","phone"],auto:!0,transform:i=>{for(const o of i)o.onClick=()=>s(o.name);return i}});ee(()=>({title:"Contacts"}));function n(){p.value=!1,e.reload()}function s(i){v.value=i,u.value=!0}function _(){E({title:"Contact updated",icon:"check",iconClasses:"text-green-500"}),u.value=!u.value,e.reload()}return(i,o)=>{const x=K,$=L("Button");return C(),I("div",Ve,[c(ae,{title:"Contacts"},{right:N(()=>[c($,{label:"New contact",theme:"gray",variant:"solid",onClick:o[0]||(o[0]=g=>p.value=!p.value)},{prefix:N(()=>[c(x,{class:"h-4 w-4"})]),_:1})]),_:1}),c(r(oe),{columns:f,resource:r(e),class:"mt-2.5",doctype:"Contact"},{name:N(({data:g})=>[m("div",xe,[c(r(J),{label:g.name,image:g.image,size:"sm"},null,8,["label","image"]),m("div",be,R(g.name),1)])]),_:1},8,["resource"]),c(ce,{modelValue:p.value,"onUpdate:modelValue":o[1]||(o[1]=g=>p.value=g),onContactCreated:n},null,8,["modelValue"]),u.value?(C(),k(ye,{key:v.value,modelValue:u.value,"onUpdate:modelValue":o[2]||(o[2]=g=>u.value=g),name:v.value,onContactUpdated:_},null,8,["modelValue","name"])):H("",!0)])}}});export{qe as default};
//# sourceMappingURL=ContactList-ada758c7.js.map
