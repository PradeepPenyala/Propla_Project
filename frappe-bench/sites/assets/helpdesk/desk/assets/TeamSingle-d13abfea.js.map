{"version":3,"file":"TeamSingle-d13abfea.js","sources":["../../../../desk/src/pages/desk/team/TeamSingle.vue"],"sourcesContent":["<template>\n  <span>\n    <div class=\"flex flex-col\">\n      <PageTitle class=\"border-b\">\n        <template #title>\n          <Breadcrumbs\n            :items=\"[\n              {\n                label: 'Teams',\n                route: {\n                  name: AGENT_PORTAL_TEAM_LIST,\n                },\n              },\n              {\n                label: teamId,\n                route: {\n                  name: AGENT_PORTAL_TEAM_SINGLE,\n                },\n              },\n            ]\"\n          />\n        </template>\n        <template #right>\n          <div class=\"flex items-center gap-2\">\n            <Button\n              label=\"Add member\"\n              theme=\"gray\"\n              variant=\"solid\"\n              @click=\"showAddMember = !showAddMember\"\n            >\n              <template #prefix>\n                <IconPlus class=\"h-4 w-4\" />\n              </template>\n            </Button>\n            <Dropdown :options=\"docOptions\">\n              <Button variant=\"ghost\">\n                <template #icon>\n                  <IconMoreHorizontal class=\"h-4 w-4\" />\n                </template>\n              </Button>\n            </Dropdown>\n          </div>\n        </template>\n      </PageTitle>\n      <div class=\"my-6\">\n        <div class=\"container\">\n          <div class=\"space-y-4\">\n            <div class=\"text-lg font-medium\">Members</div>\n            <div v-if=\"!isEmpty(team.doc?.users)\" class=\"flex flex-wrap gap-2\">\n              <Pill\n                v-for=\"member in team.doc?.users\"\n                :key=\"member.user\"\n                :label=\"member.user\"\n                :disabled=\"team.loading\"\n                @click=\"(user) => removeMember(user)\"\n              />\n            </div>\n            <div v-else class=\"text-base text-gray-900\">\n              No members found in team: {{ teamId }}\n            </div>\n            <Switch\n              v-model=\"ignoreRestrictions\"\n              size=\"md\"\n              label=\"Bypass restrictions\"\n              description=\"Members of this team will be able to bypass any team-wise restriction\"\n              class=\"rounded border p-4\"\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n    <Dialog v-model=\"showRename\" :options=\"renameDialogOptions\">\n      <template #body-content>\n        <div class=\"space-y-2\">\n          <FormControl\n            v-model=\"title\"\n            label=\"Title\"\n            placeholder=\"Product Experts\"\n          />\n          <Button\n            label=\"Confirm\"\n            theme=\"gray\"\n            variant=\"solid\"\n            class=\"w-full\"\n            :disabled=\"title === teamId\"\n            @click=\"renameTeam\"\n          />\n        </div>\n      </template>\n    </Dialog>\n    <Dialog v-model=\"showDelete\" :options=\"deleteDialogOptions\" />\n    <Dialog v-model=\"showAddMember\" :options=\"addMemberDialogOptions\">\n      <template #body-content>\n        <div class=\"space-y-2\">\n          <div v-if=\"agentStore.agents.data.length === 0\">\n            <p class=\"text-base text-gray-600\">\n              No agents found, please add\n              <span\n                class=\"cursor-pointer underline\"\n                @click=\"router.push('/agents')\"\n                >agents</span\n              >\n              in the system.\n            </p>\n          </div>\n          <div\n            v-for=\"agent in agentStore.agents.data\"\n            v-else\n            :key=\"agent.name\"\n            class=\"flex items-center justify-between\"\n          >\n            <div class=\"flex items-center gap-2\">\n              <Avatar :label=\"agent.agent_name\" :image=\"agent.user_image\" />\n              <div class=\"text-base\">\n                {{ agent.agent_name }}\n              </div>\n            </div>\n            <Button\n              :disabled=\"!!team.doc?.users.find((u) => u.user === agent.user)\"\n              label=\"Add\"\n              theme=\"gray\"\n              variant=\"outline\"\n              @click=\"addMember(agent.user)\"\n            />\n          </div>\n        </div>\n      </template>\n    </Dialog>\n  </span>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, ref } from \"vue\";\nimport { useRouter } from \"vue-router\";\nimport {\n  createDocumentResource,\n  createResource,\n  Avatar,\n  Button,\n  Dialog,\n  Dropdown,\n  FormControl,\n  Switch,\n  Breadcrumbs,\n} from \"frappe-ui\";\nimport { isEmpty } from \"lodash\";\nimport { AGENT_PORTAL_TEAM_LIST, AGENT_PORTAL_TEAM_SINGLE } from \"@/router\";\nimport { useAgentStore } from \"@/stores/agent\";\nimport { useError } from \"@/composables/error\";\nimport { PageTitle } from \"@/components\";\nimport IconMoreHorizontal from \"~icons/lucide/more-horizontal\";\nimport IconPlus from \"~icons/lucide/plus\";\nimport Pill from \"@/components/Pill.vue\";\n\nconst props = defineProps({\n  teamId: {\n    type: String,\n    required: true,\n  },\n});\n\nconst router = useRouter();\nconst agentStore = useAgentStore();\nconst showRename = ref(false);\nconst showDelete = ref(false);\nconst showAddMember = ref(false);\nconst team = createDocumentResource({\n  doctype: \"HD Team\",\n  name: props.teamId,\n  auto: true,\n  setValue: {\n    onError: useError({ title: \"Error updating team\" }),\n  },\n  delete: {\n    onSuccess() {\n      router.replace({\n        name: AGENT_PORTAL_TEAM_LIST,\n      });\n    },\n    onError: useError({ title: \"Error deleting team\" }),\n  },\n});\nconst title = computed({\n  get() {\n    return team.doc?.name;\n  },\n  set(t: string) {\n    team.doc.name = t;\n  },\n});\nconst ignoreRestrictions = computed({\n  get() {\n    return !!team.doc?.ignore_restrictions;\n  },\n  set(value: boolean) {\n    if (!team.doc) return;\n    team.setValue.submit({\n      ignore_restrictions: value,\n    });\n  },\n});\nconst docOptions = [\n  {\n    label: \"Rename\",\n    icon: \"edit-3\",\n    onClick: () => (showRename.value = !showRename.value),\n  },\n  {\n    label: \"Delete\",\n    icon: \"trash-2\",\n    onClick: () => (showDelete.value = !showDelete.value),\n  },\n];\nconst renameDialogOptions = { title: \"Rename team\" };\nconst addMemberDialogOptions = { title: \"Add member\" };\nconst deleteDialogOptions = {\n  title: \"Delete team\",\n  message: `Are you sure you want to delete ${props.teamId}? This action cannot be reversed!`,\n  actions: [\n    {\n      label: \"Confirm\",\n      theme: \"red\",\n      variant: \"solid\",\n      onClick: () => team.delete.submit(),\n    },\n  ],\n};\n\nfunction renameTeam() {\n  const r = createResource({\n    url: \"frappe.client.rename_doc\",\n    makeParams() {\n      return {\n        doctype: \"HD Team\",\n        old_name: props.teamId,\n        new_name: title.value,\n      };\n    },\n    validate(params) {\n      if (!params.new_name) return \"New title is required\";\n      if (params.new_name === params.old_name)\n        return \"New and old title cannot be same\";\n    },\n    onSuccess() {\n      router.replace({\n        name: AGENT_PORTAL_TEAM_SINGLE,\n        params: {\n          teamId: title.value,\n        },\n      });\n    },\n    onError: useError({ title: \"Error renaming team\" }),\n  });\n\n  r.submit();\n}\n\nfunction addMember(user: string) {\n  const users = team.doc.users.concat([{ user }]);\n  team.setValue.submit({\n    users,\n  });\n}\n\nfunction removeMember(member: string) {\n  const users = team.doc.users.filter((u) => u.user !== member);\n  team.setValue.submit({\n    users,\n  });\n}\n</script>\n"],"names":["props","__props","router","useRouter","agentStore","useAgentStore","showRename","ref","showDelete","showAddMember","team","createDocumentResource","useError","AGENT_PORTAL_TEAM_LIST","title","computed","t","ignoreRestrictions","value","docOptions","renameDialogOptions","addMemberDialogOptions","deleteDialogOptions","renameTeam","createResource","params","AGENT_PORTAL_TEAM_SINGLE","addMember","user","users","removeMember","member","u"],"mappings":"gyCA0JA,MAAAA,EAAAC,EAOAC,EAAAC,IACAC,EAAAC,IACAC,EAAAC,EAAA,EAAA,EACAC,EAAAD,EAAA,EAAA,EACAE,EAAAF,EAAA,EAAA,EACAG,EAAAC,EAAA,CAAoC,QAAA,UACzB,KAAAX,EAAA,OACG,KAAA,GACN,SAAA,CACI,QAAAY,EAAA,CAAA,MAAA,qBAAA,CAAA,CAC0C,EACpD,OAAA,CACQ,WAAA,CAEJV,EAAA,QAAA,CAAe,KAAAW,CACP,CAAA,CACP,EACH,QAAAD,EAAA,CAAA,MAAA,qBAAA,CAAA,CACkD,CACpD,CAAA,EAEFE,EAAAC,EAAA,CAAuB,KAAA,CAEnB,OAAAL,EAAA,KAAA,IAAiB,EACnB,IAAAM,EAAA,CAEEN,EAAA,IAAA,KAAAM,CAAgB,CAClB,CAAA,EAEFC,EAAAF,EAAA,CAAoC,KAAA,CAEhC,MAAA,CAAA,CAAAL,EAAA,KAAA,mBAAmB,EACrB,IAAAQ,EAAA,CAEER,EAAA,KACAA,EAAA,SAAA,OAAA,CAAqB,oBAAAQ,CACE,CAAA,CACtB,CACH,CAAA,EAEFC,EAAA,CAAmB,CACjB,MAAA,SACS,KAAA,SACD,QAAA,IAAAb,EAAA,MAAA,CAAAA,EAAA,KACyC,EACjD,CACA,MAAA,SACS,KAAA,UACD,QAAA,IAAAE,EAAA,MAAA,CAAAA,EAAA,KACyC,CACjD,EAEFY,EAAA,CAAA,MAAA,eACAC,EAAA,CAAA,MAAA,cACAC,EAAA,CAA4B,MAAA,cACnB,QAAA,mCAAAtB,EAAA,MAAA,oCACiD,QAAA,CAC/C,CACP,MAAA,UACS,MAAA,MACA,QAAA,QACE,QAAA,IAAAU,EAAA,OAAA,OAAA,CACyB,CACpC,CACF,EAGF,SAAAa,GAAA,CACEC,EAAA,CAAyB,IAAA,2BAClB,YAAA,CAEH,MAAA,CAAO,QAAA,UACI,SAAAxB,EAAA,OACO,SAAAc,EAAA,KACA,CAClB,EACF,SAAAW,EAAA,CAEE,GAAA,CAAAA,EAAA,SAAsB,MAAA,wBACtB,GAAAA,EAAA,WAAAA,EAAA,SACE,MAAA,kCAAO,EACX,WAAA,CAEEvB,EAAA,QAAA,CAAe,KAAAwB,EACP,OAAA,CACE,OAAAZ,EAAA,KACQ,CAChB,CAAA,CACD,EACH,QAAAF,EAAA,CAAA,MAAA,qBAAA,CAAA,CACkD,CAAA,EAGpD,OAAA,CAAS,CAGX,SAAAe,EAAAC,EAAA,CACE,MAAAC,EAAAnB,EAAA,IAAA,MAAA,OAAA,CAAA,CAAA,KAAAkB,CAAA,CAAA,CAAA,EACAlB,EAAA,SAAA,OAAA,CAAqB,MAAAmB,CACnB,CAAA,CACD,CAGH,SAAAC,EAAAC,EAAA,CACE,MAAAF,EAAAnB,EAAA,IAAA,MAAA,OAAAsB,GAAAA,EAAA,OAAAD,CAAA,EACArB,EAAA,SAAA,OAAA,CAAqB,MAAAmB,CACnB,CAAA,CACD"}