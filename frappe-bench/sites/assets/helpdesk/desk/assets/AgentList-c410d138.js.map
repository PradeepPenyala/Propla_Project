{"version":3,"file":"AgentList-c410d138.js","sources":["../../../../desk/src/components/desk/global/AddNewAgentsDialog.vue","../../../../desk/src/pages/desk/agent/AgentList.vue"],"sourcesContent":["<template>\n  <div>\n    <Dialog :options=\"{ title: 'Add Agents' }\" :show=\"show\" @close=\"close()\">\n      <template #body-content>\n        <div class=\"space-y-3\">\n          <form\n            @submit.prevent=\"onSubmit\"\n            class=\"flex flex-row items-center space-x-2\"\n          >\n            <Input\n              id=\"searchInput\"\n              class=\"w-full\"\n              type=\"text\"\n              v-model=\"searchInput\"\n              placeholder=\"Type emails\"\n              @input=\"(val) => onSearchInputChange(val)\"\n            />\n            <Button\n              appearance=\"primary\"\n              type=\"submit\"\n              :disabled=\"!currentInputIsValidEmail\"\n              @click=\"\n                () => {\n                  addToInviteQueue(searchInput);\n                  clearSearchInput();\n                }\n              \"\n            >\n              Add\n            </Button>\n          </form>\n          <div\n            class=\"flex max-h-[300px] min-h-[100px] flex-col overflow-y-auto rounded border bg-gray-100 px-2\"\n            v-if=\"inviteQueue.length\"\n          >\n            <ul class=\"flex flex-wrap gap-2 py-2\">\n              <li\n                class=\"flex items-center space-x-2 rounded bg-white p-1 shadow\"\n                v-for=\"email in inviteQueue.slice().reverse()\"\n                :key=\"email\"\n                :title=\"email\"\n              >\n                <span class=\"ml-2 text-base\">\n                  {{ email }}\n                </span>\n                <button\n                  class=\"grid h-4 w-4 place-items-center rounded text-gray-700 hover:bg-gray-300\"\n                  @click=\"removeEmailFromQueue(email)\"\n                >\n                  <FeatherIcon class=\"w-3\" name=\"x\" />\n                </button>\n              </li>\n            </ul>\n          </div>\n        </div>\n      </template>\n      <template #actions v-if=\"inviteQueue.length\">\n        <Button\n          :disabled=\"inviteQueue.length == 0\"\n          appearance=\"primary\"\n          @click=\"sentInvites()\"\n          class=\"mr-2\"\n          :loading=\"$resources.sentInvites.loading\"\n          >Send Invites</Button\n        >\n        <Button appearance=\"secondary\" class=\"mr-2\" @click=\"close()\"\n          >Cancel</Button\n        >\n        <div class=\"grow\">\n          <Button\n            @click=\"removeAllEmailFromQueue()\"\n            v-if=\"inviteQueue.length > 1\"\n          >\n            Clear All\n          </Button>\n        </div>\n      </template>\n    </Dialog>\n  </div>\n</template>\n\n<script>\nimport { Dialog, Input, FeatherIcon } from \"frappe-ui\";\nimport { ref } from \"@vue/reactivity\";\n\nexport default {\n  name: \"AddNewAgentsDialog\",\n  props: [\"show\"],\n  components: {\n    Dialog,\n    Input,\n    FeatherIcon,\n  },\n  setup() {\n    const searchInput = ref(\"\");\n    const inviteQueue = ref([]);\n\n    const currentInputIsValidEmail = ref(false);\n\n    return {\n      searchInput,\n      inviteQueue,\n      currentInputIsValidEmail,\n    };\n  },\n  methods: {\n    testEmailRegex(val) {\n      let emailRegex = /^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$/;\n      return emailRegex.test(val);\n    },\n    onSearchInputChange(val) {\n      val = val.replaceAll(\" \", \"\");\n\n      if (val == \"\") {\n        document.getElementById(\"searchInput\").value = \"\";\n        return;\n      }\n\n      const valStr = val;\n      const inputs = val.split(\",\");\n\n      let clearInputFlag = false;\n      this.currentInputIsValidEmail = false;\n      inputs.forEach((input) => {\n        if (this.testEmailRegex(input)) {\n          if (inputs.length > 1) {\n            this.addToInviteQueue(input);\n            clearInputFlag = true;\n          } else {\n            if (valStr.includes(\",\")) {\n              this.addToInviteQueue(input);\n              clearInputFlag = true;\n            } else {\n              this.currentInputIsValidEmail = true;\n            }\n          }\n        }\n      });\n      if (clearInputFlag) {\n        this.clearSearchInput();\n      }\n    },\n    addToInviteQueue(email) {\n      this.inviteQueue = [...new Set([...this.inviteQueue, email])];\n    },\n    removeEmailFromQueue(email) {\n      this.inviteQueue = this.inviteQueue.filter((item) => item !== email);\n    },\n    removeAllEmailFromQueue() {\n      this.inviteQueue = [];\n    },\n    clearSearchInput() {\n      this.currentInputIsValidEmail = false;\n      this.searchInput = \"\";\n\n      const input = document.getElementById(\"searchInput\");\n      input.value = \"\";\n      input.focus();\n    },\n    close() {\n      this.searchInput = \"\";\n      this.inviteQueue = [];\n      this.$emit(\"close\");\n    },\n    sentInvites() {\n      this.$resources.sentInvites.submit({\n        emails: this.inviteQueue,\n      });\n    },\n  },\n  resources: {\n    sentInvites() {\n      return {\n        url: \"helpdesk.api.agent.sent_invites\",\n        onSuccess: (res) => {\n          this.currentInputIsValidEmail = false;\n          this.searchInput = \"\";\n          this.inviteQueue = [];\n\n          this.$toast({\n            title: \"Invites Sent Successfully!\",\n            icon: \"check\",\n            iconClasses: \"text-green-500\",\n          });\n\n          this.close();\n        },\n        onError: (err) => {\n          if (err.exc_type == \"PaywallReachedError\") {\n            this.$toast({\n              title: \"Paywall Reached!\",\n              text: \"You have reached the maximum number of agents you can add. Please upgrade your plan to add more agents.\",\n              icon: \"x\",\n              iconClasses: \"text-red-500\",\n            });\n          } else {\n            this.$toast({\n              title: \"Error Sending Invites!\",\n              icon: \"x\",\n              iconClasses: \"text-red-500\",\n            });\n          }\n        },\n      };\n    },\n  },\n};\n</script>\n","<template>\n  <div class=\"flex flex-col\">\n    <PageTitle title=\"Agents\">\n      <template #right>\n        <Button\n          label=\"New agent\"\n          theme=\"gray\"\n          variant=\"solid\"\n          @click=\"isDialogVisible = !isDialogVisible\"\n        >\n          <template #prefix>\n            <LucidePlus class=\"h-4 w-4\" />\n          </template>\n        </Button>\n      </template>\n    </PageTitle>\n    <ListView\n      :columns=\"columns\"\n      :resource=\"agents\"\n      class=\"mt-2.5\"\n      doctype=\"HD Agent\"\n    >\n      <template #name=\"{ data }\">\n        <div class=\"flex items-center justify-between\">\n          <div class=\"flex items-center gap-2\">\n            <Avatar :label=\"data.name\" :image=\"data.user_image\" size=\"sm\" />\n            <div class=\"line-clamp-1\">{{ data.full_name }}</div>\n          </div>\n          <Badge\n            v-if=\"!data.is_active\"\n            size=\"md\"\n            theme=\"orange\"\n            variant=\"subtle\"\n            >Inactive</Badge\n          >\n        </div>\n      </template>\n      <template #row-extra=\"{ data }\">\n        <div class=\"cursor-pointer text-xs\" @click=\"toTickets(data.name)\">\n          Tickets &rightarrow;\n        </div>\n      </template>\n    </ListView>\n    <AddNewAgentsDialog\n      :show=\"isDialogVisible\"\n      @close=\"isDialogVisible = false\"\n    />\n  </div>\n</template>\n<script setup lang=\"ts\">\nimport { ref } from \"vue\";\nimport { usePageMeta, Avatar, Badge } from \"frappe-ui\";\nimport { AGENT_PORTAL_TICKET_LIST } from \"@/router\";\nimport { createListManager } from \"@/composables/listManager\";\nimport { useFilter } from \"@/composables/filter\";\nimport AddNewAgentsDialog from \"@/components/desk/global/AddNewAgentsDialog.vue\";\nimport PageTitle from \"@/components/PageTitle.vue\";\nimport { ListView } from \"@/components\";\n\nconst { apply, storage } = useFilter(\"HD Ticket\");\nconst isDialogVisible = ref(false);\nconst columns = [\n  {\n    label: \"Name\",\n    key: \"name\",\n    width: \"w-80\",\n  },\n  {\n    label: \"Email\",\n    key: \"email\",\n    width: \"w-80\",\n  },\n  {\n    label: \"Username\",\n    key: \"username\",\n    width: \"w-80\",\n  },\n];\n\nconst agents = createListManager({\n  doctype: \"HD Agent\",\n  fields: [\n    \"name\",\n    \"is_active\",\n    \"user.full_name\",\n    \"user.user_image\",\n    \"user.email\",\n    \"user.username\",\n  ],\n  filters: {\n    is_active: \"1\",\n  },\n  auto: true,\n  transform: (data) => {\n    for (const d of data) {\n      d.onClick = () => toTickets(d.name);\n    }\n    return data;\n  },\n});\n\nusePageMeta(() => {\n  return {\n    title: \"Agents\",\n  };\n});\n\nfunction toTickets(user: string) {\n  storage.value.clear();\n  storage.value.add({\n    fieldname: \"_assign\",\n    operator: \"is\",\n    value: user,\n  });\n  apply({\n    name: AGENT_PORTAL_TICKET_LIST,\n  });\n}\n</script>\n"],"names":["_sfc_main","Dialog","currentInputIsValidEmail","ref","val","valStr","input","inputs","clearInputFlag","item","email","res","err","_hoisted_1","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","$props","_cache","$event","$options","_createSlots","_withCtx","_createElementVNode","$setup","_createTextVNode","_openBlock","_createElementBlock","_hoisted_2","_createCommentVNode","_ctx","apply","storage","useFilter","isDialogVisible","columns","agents","createListManager","data","d","toTickets","usePageMeta","user","AGENT_PORTAL_TICKET_LIST"],"mappings":"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"}