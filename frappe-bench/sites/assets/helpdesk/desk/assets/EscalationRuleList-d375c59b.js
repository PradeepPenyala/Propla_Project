import{_ as H}from"./plus-3ad50efe.js";import{d as E,t as V,o as u,i as m,f as v,q as D,F as S,r as $,g as n,S as R,I as N,W as b,E as B,N as f,e as T,w as _,h as k,D as P,v as x,a6 as q,c6 as C,z as A,B as L,a9 as F}from"./index-a86022ab.js";import{c as U}from"./listManager-63aba0ed.js";import"./vuedraggable.umd-9334f31c.js";import{_ as M}from"./LV.vue_vue_type_script_setup_true_lang-23701244.js";import{_ as j}from"./PageTitle.vue_vue_type_script_setup_true_lang-022e67c2.js";import"./iconify-6a43d462.js";import{u as h}from"./error-90c51c34.js";import{a as z}from"./Autocomplete-28eb1937.js";import"./EmptyMessage.vue_vue_type_script_setup_true_lang-123dde9f.js";import"./TabButtons-ea997705.js";import"./label-fe9568ec.js";const I={class:"space-y-2"},O={class:"text-lg font-medium text-gray-900"},W={class:"flex flex-wrap items-center gap-2 text-base"},G={class:"text-gray-800"},J={key:0,class:"text-gray-600"},w=E({__name:"EscalationRuleDialogFieldList",props:{title:{type:String,required:!0},items:{type:Array,required:!0},doc:{type:Object,required:!0}},emits:["update:doc"],setup(r,{emit:c}){const a=r,d=c,e=V(a,"doc");function s(l,o){d("update:doc",{...e.value,[l]:o})}return(l,o)=>(u(),m("div",I,[v("div",O,D(r.title),1),v("div",W,[(u(!0),m(S,null,$(r.items,(i,p)=>(u(),m("div",{key:i.key,class:"flex items-center gap-2"},[v("div",G,D(i.label),1),n(z,{placeholder:"Any",doctype:i.doctype,value:e.value[i.key],onChange:t=>s(i.key,t.value)},null,8,["doctype","value","onChange"]),p+1<r.items.length?(u(),m("span",J," and ")):R("",!0)]))),128))])]))}}),K={class:"space-y-4"},Q=E({__name:"EscalationRuleDialog",props:{name:{type:String,required:!0}},setup(r){const a=N({doctype:"HD Escalation Rule",name:r.name||747,fields:["name","priority","team","to_team","to_agent","to_priority"],auto:!0,onError(){a.doc={}},setValue:{debounce:3e3,onSuccess(){b({title:"Rule updated",icon:"check",iconClasses:"text-green-500"})},onError:h({title:"Error updating rule"})},delete:{onSuccess(){b({title:"Rule deleted",icon:"check",iconClasses:"text-green-500"})},onError:h({title:"Error deleting rule"})}}),d=B({url:"frappe.client.insert",onSuccess(t){b({title:"Rule created",icon:"check",iconClasses:"text-green-500"}),a.name=t.name,a.reload()},onError:h({title:"Error creating rule"})}),e=f({get(){return a.doc||{}},set(t){a.doc=t}}),s=f(()=>!e.value.name);function l(){const t={is_enabled:e.value.is_enabled,priority:e.value.priority,team:e.value.team,ticket_type:e.value.ticket_type,to_agent:e.value.to_agent,to_priority:e.value.to_priority,to_team:e.value.to_team,to_ticket_type:e.value.to_ticket_type};if(e.value.name){a.setValue.submit(t);return}d.submit({doc:{doctype:"HD Escalation Rule",...t}})}const o=f(()=>({title:s.value?"New rule":"Edit rule",actions:[{label:s.value?"Create":"Save",theme:"gray",variant:"subtle",onClick:()=>l()},{label:e.value?.is_enabled?"Disable":"Enable",theme:e.value?.is_enabled?"red":"green",variant:"subtle",onClick:()=>a.setValue.submit({is_enabled:!e.value.is_enabled}),hidden:s.value},{label:"Delete",theme:"red",variant:"subtle",onClick:()=>a.delete.submit(),hidden:s.value}].filter(t=>!t.hidden)})),i=[{label:"Priority is",doctype:"HD Ticket Priority",key:"priority"},{label:"Team is",doctype:"HD Team",key:"team"},{label:"Ticket type is",doctype:"HD Ticket Type",key:"ticket_type"}],p=[{label:"Change priority to",doctype:"HD Ticket Priority",key:"to_priority"},{label:"Change team to",doctype:"HD Team",key:"to_team"},{label:"Change ticket type to",doctype:"HD Ticket Type",key:"to_ticket_type"},{label:"Assign to",doctype:"HD Agent",key:"to_agent"}];return(t,y)=>(u(),T(k(P),{options:o.value},{"body-content":_(()=>[v("div",K,[n(w,{doc:e.value,"onUpdate:doc":y[0]||(y[0]=g=>e.value=g),title:"Criteria",items:i},null,8,["doc"]),n(w,{doc:e.value,"onUpdate:doc":y[1]||(y[1]=g=>e.value=g),title:"Actions",items:p},null,8,["doc"])])]),_:1},8,["options"]))}}),X={class:"flex flex-col"},ue=E({__name:"EscalationRuleList",setup(r){const c=x(!1),a=x(null),d=[{label:"Priority",key:"priority",width:"w-64"},{label:"Team",key:"team",width:"w-64"},{label:"Ticket type",key:"ticket_type",width:"w-64"},{label:"Status",key:"is_enabled",width:"w-20"}],e=U({doctype:"HD Escalation Rule",fields:["name","priority","team","ticket_type","is_enabled"],auto:!0,transform:l=>{for(const o of l)o.onClick=()=>s(o.name);return l}});q(()=>({title:"Escalation rules"}));function s(l){a.value=l,c.value=!0}return C.on("helpdesk:new-escalation-rule",()=>e.reload()),C.on("helpdesk:delete-escalation-rule",()=>e.reload()),(l,o)=>{const i=H,p=A("Button");return u(),m("div",X,[n(j,{title:"Escalation Rules"},{right:_(()=>[n(p,{label:"New rule",theme:"gray",variant:"solid",onClick:o[0]||(o[0]=t=>s(null))},{prefix:_(()=>[n(i,{class:"h-4 w-4"})]),_:1})]),_:1}),n(k(M),{columns:d,resource:k(e),class:"mt-2.5",doctype:"HD Escalation Rule"},{is_enabled:_(({data:t})=>[n(k(F),{theme:t.is_enabled?"green":"red",variant:"subtle"},{default:_(()=>[L(D(t.is_enabled?"Enabled":"Disabled"),1)]),_:2},1032,["theme"])]),_:1},8,["resource"]),c.value?(u(),T(Q,{key:0,modelValue:c.value,"onUpdate:modelValue":o[1]||(o[1]=t=>c.value=t),name:a.value},null,8,["modelValue","name"])):R("",!0)])}}});export{ue as default};
//# sourceMappingURL=EscalationRuleList-d375c59b.js.map
