import{d as S,o as n,i as d,g as F,U as N,ao as A,ac as _,z as M,f as g,h as s,e as b,S as x,F as L,r as V,n as C,q as B,aj as W,as as X,b as Y,u as Z,E as ee,a4 as D,aL as te,O as se,w as P,aa as R,B as oe,G as ae,c7 as ne,c8 as re,b3 as le,v as ie,N as K,ae as w,b8 as ce,T as ue,J as de,L as pe,b1 as me}from"./index-a86022ab.js";import{s as f,p as fe}from"./vuedraggable.umd-9334f31c.js";import{_ as ge}from"./EmptyMessage.vue_vue_type_script_setup_true_lang-123dde9f.js";import{T as ye}from"./TabButtons-ea997705.js";import{u as he}from"./error-90c51c34.js";const T=Symbol("Checkbox"),j=Symbol("Columns"),I=Symbol("DocType"),_e=Symbol("Filter"),O=Symbol("Id"),G=Symbol("Plural"),q=Symbol("Resource"),J=Symbol("Singular"),ve={class:"flex h-full w-full items-center justify-center text-base text-gray-700"},ke=S({__name:"LVEmpty",props:{message:{}},setup(p){return(a,i)=>(n(),d("div",ve,[F(ge,{message:a.message},null,8,["message"])]))}});function U(p){const l=["hide_columns",N().path,p].join("_"),r=A(l,new Set);function c(m){r.value.delete(m)||r.value.add(m)}return{storage:r,toggle:c}}const be={class:"mx-5 rounded bg-gray-100 px-2.5 py-2 text-sm text-gray-600"},xe={class:"flex w-full items-center gap-2"},we=S({__name:"LVHeader",setup(p){const a=_(T),i=_(j),l=_(I),r=_(q),{storage:c}=U(l);function m(){if(f.storage.size===r.data.length){f.storage.clear();return}r.data.forEach(h=>f.storage.add(h.name))}return(h,v)=>{const t=M("FormControl");return n(),d("div",be,[g("div",xe,[s(a)?(n(),b(t,{key:0,type:"checkbox","model-value":s(r).data?.length===s(f).storage.size,"onUpdate:modelValue":v[0]||(v[0]=u=>m())},null,8,["model-value"])):x("",!0),(n(!0),d(L,null,V(s(i),u=>(n(),d("div",{key:u.key},[s(c).has(u.key)?x("",!0):(n(),d("div",{key:0,class:C([u.width])},[g("span",{class:C([u.align])},B(u.label),3)],2))]))),128))])])}}}),$e={class:"animate-pulse divide-y overflow-y-auto px-2.5"},Ce={key:0,class:"h-3.5 w-3.5 rounded-sm bg-gray-200"},Se=g("div",{class:"h-4 rounded-sm bg-gray-200"},null,-1),Le=[Se],Ve=S({__name:"LVLoading",setup(p){const a=_(T),i=_(j),l=_(O),{storage:r}=U(l);return(c,m)=>(n(),d("div",$e,[(n(),d(L,null,V(20,h=>g("div",{key:h,class:"flex h-10 w-full items-center space-x-2 px-5"},[s(a)?(n(),d("div",Ce)):x("",!0),(n(!0),d(L,null,V(s(i),v=>(n(),d("div",{key:v.key,class:"flex items-center space-x-2"},[s(r).has(v.key)?x("",!0):(n(),d("div",{key:0,class:C([v.width])},Le,2))]))),128))])),64))]))}}),Be={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},Ee=g("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"},null,-1),Fe=[Ee];function ze(p,a){return n(),d("svg",Be,[...Fe])}const Ke={name:"lucide-loader2",render:ze},Pe={class:"flex items-center justify-between border-t px-5 py-2"},Re={class:"flex items-center"},Te={key:1,class:"space-x-1 text-base"},je={class:"text-gray-900"},qe=g("span",{class:"text-gray-700"},"of",-1),De={class:"text-gray-900"},Ne=S({__name:"LVNavigation",setup(p){const a=[20,50,500],i=_(q);return(l,r)=>{const c=Ke;return n(),d("div",Pe,[F(s(ye),{buttons:a.map(m=>({label:m})),"model-value":s(i).pageLength,"onUpdate:modelValue":r[0]||(r[0]=m=>{s(i).update({pageLength:m}),s(i).reload()})},null,8,["buttons","model-value"]),g("span",Re,[s(i).list.loading?(n(),b(c,{key:0,class:"mr-2 inline h-4 w-4 animate-spin"})):x("",!0),s(i).data?.length?(n(),d("span",Te,[g("span",je,B(s(i).data?.length),1),qe,g("span",De,B(s(i).totalCount),1)])):x("",!0)])])}}}),Ie=W("fields",()=>{const p=new Map;async function a(l){if(p.has(l))return;await X("helpdesk.api.doc.get_filterable_fields",{doctype:l}).then(c=>p.set(l,c)).catch(he())}function i(l){return p.get(l)||[]}return{fetch:a,get:i}}),Ue="filters_",H={is:"=","is not":"!=",equals:"=","not equals":"!=",yes:!0,no:!1,like:"LIKE","not like":"NOT LIKE",">":">","<":"<",">=":">=","<=":"<="};function He(p){const a=N(),i=Y(),{userId:l}=Z(),r=A(Ue+a.name.toString(),new Set),c=ee({url:"helpdesk.api.doc.get_filterable_fields",cache:["DocField",p],auto:!!p,params:{doctype:p,append_assign:!0},transform:e=>(e=D.orderBy(e.map(y=>({label:y.label,value:y.fieldname,...y})),"label"),e)});te(()=>{if(!c.data)return;const e=a.query.q;e&&(r.value=new Set(m(e,c.data)))});function m(e,y){return e.split(" ").map(k=>{const[$,z,E]=k.split(":").map(decodeURIComponent);return{field:(y||[]).find(Q=>Q.fieldname===$),fieldname:$,operator:z,value:E}}).filter(k=>!y||y&&k.field).filter(k=>H[k.operator])}function h(e){e=e||{};const k=Array.from(r.value).map(u).reduce((z,E)=>(z[E.fieldname]=[H[E.operator.toLowerCase()],E.value],z),{});return{...e,...k}}function v(e){r.value.forEach(y=>{y.fieldname===e.fieldname&&r.value.delete(y)}),r.value.add(e)}function t(e){e=e||a;const k=Array.from(r.value).map(o).map($=>[$.fieldname,$.operator.toLowerCase(),$.value].map(encodeURIComponent).join(":")).join(" ");i.push({...e,query:{...e.query,q:k}})}function u(e){return e.fieldname==="_assign"&&(e.operator=e.operator==="is"?"like":"not like"),e.operator.includes("like")&&(e.value=`%${e.value}%`),e}function o(e){return e.value==="@me"&&(e.value=l),e}return{add:v,apply:t,fields:c,getArgs:h,storage:r}}const Ae=["onClick"],Me=S({__name:"LVRow",props:{data:{}},setup(p){const a=_(T),i=_(j),l=_(I),r=p,{storage:c}=U(l),m=Ie(),h=He(l);async function v(t,u){l&&(await m.fetch(l),m.get(l).filter(o=>["Link","Select"].includes(o.fieldtype)).filter(o=>o.fieldname===u.key).map(o=>{let e=r.data[u.key];return o.fieldname==="_assign"&&(e=re(e)),{fieldname:o.fieldname,label:o.label,operator:"is",value:e}}).filter(o=>o.value).forEach(o=>{t.preventDefault(),t.stopPropagation(),h.add(o),h.apply()}))}return(t,u)=>(n(),d("div",{class:C(["group mx-5 flex h-10 items-center gap-2 whitespace-nowrap px-2.5 text-base",{"bg-blue-100":s(f).storage.has(t.data.name),"hover:bg-blue-200":s(f).storage.has(t.data.name),"hover:bg-gray-100":!s(f).storage.has(t.data.name),"cursor-pointer":!!t.data.onClick,...t.data.class}])},[s(a)?(n(),b(s(se),{key:0,type:"checkbox","model-value":s(f).storage.has(t.data.name),"onUpdate:modelValue":u[0]||(u[0]=o=>s(f).toggle(t.data.name))},null,8,["model-value"])):x("",!0),(n(),b(ae(s(D.isFunction)(t.data.onClick)?"span":s(ne)),{as:"template",to:t.data.onClick,class:"flex w-full items-center gap-2",onClick:u[1]||(u[1]=o=>{s(D.isFunction)(t.data.onClick)&&(o.preventDefault(),t.data.onClick())})},{default:P(()=>[(n(!0),d(L,null,V(s(i),o=>(n(),d("div",{key:o.key,class:C({"text-gray-800":t.data[o.key],"text-gray-300":!t.data[o.key]})},[s(c).has(o.key)?x("",!0):(n(),d("div",{key:0,class:C([o.width])},[g("div",{class:C(["w-max max-w-full truncate",[o.align,o.text]]),onClick:e=>v(e,o)},[R(t.$slots,o.key,{data:t.data},()=>[oe(B(t.data[o.key]||"â¸º"),1)])],10,Ae)],2))],2))),128))]),_:3},8,["to"]))],2))}}),Oe={key:0,class:"fixed inset-x-0 bottom-6 mx-auto flex w-max items-center gap-1 rounded bg-white p-1 text-base shadow"},Ge={class:"inline-block w-64 pl-2 align-middle text-gray-900"},Je={class:"space-x-2"},Qe=g("div",{class:"text-gray-300"},"|",-1),We=S({__name:"LVSelectionBar",setup(p){const a=_(q),i=_(J),l=_(G);function r(){if(f.storage.size===a.data?.length){f.storage.clear();return}a.data.forEach(c=>f.storage.add(c.name))}return(c,m)=>{const h=M("Button");return n(),b(le,{"enter-active-class":"duration-300 ease-out","enter-from-class":"transform opacity-0","enter-to-class":"opacity-100","leave-active-class":"duration-200 ease-in","leave-from-class":"opacity-100","leave-to-class":"transform opacity-0"},{default:P(()=>[s(f).storage.size?(n(),d("div",Oe,[g("div",Ge,B(s(f).storage.size)+" "+B(s(f).storage.size<2?s(i):s(l))+" selected ",1),g("span",Je,[R(c.$slots,"actions",{selection:s(f).storage})]),Qe,F(h,{disabled:s(a).data?.length===s(f).storage.size,label:"Select all",variant:"ghost",onClick:m[0]||(m[0]=v=>r())},null,8,["disabled"])])):x("",!0)]),_:3})}}}),Xe={class:"mt-2 flex w-full grow flex-col overflow-hidden overflow-x-auto"},Ye={class:"flex h-full w-max min-w-full flex-col overflow-y-hidden text-gray-900"},nt=S({__name:"LV",props:{columns:{},doctype:{},resource:{},checkbox:{type:Boolean,default:!1},filter:{type:Boolean,default:!1}},setup(p){const a=p,i=N(),l=ie(null),r=K(()=>a.doctype.replace("HD ","").toLowerCase().trim()),c=K(()=>fe.plural(r.value)),m=K(()=>`No ${c.value} found`),h=K(()=>i.path+"_"+a.doctype),v=me(()=>{if(!a.resource.hasNextPage)return;const t=l.value.scrollHeight,u=l.value.scrollTop,o=l.value.clientHeight;u/(t-o)*100>=90&&a.resource.next()},500);return w(T,a.checkbox),w(j,a.columns),w(I,a.doctype),w(_e,a.filter),w(O,h.value),w(G,c),w(q,a.resource),w(J,r),(t,u)=>(n(),d(L,null,[g("div",Xe,[g("div",Ye,[t.resource.data?.length?(n(),b(we,{key:1})):(n(),b(ke,{key:0,message:m.value},null,8,["message"])),g("div",{ref_key:"body",ref:l,class:"grow divide-y overflow-y-auto",onScroll:u[0]||(u[0]=()=>s(v)())},[t.resource.loading?(n(),b(Ve,{key:0})):(n(!0),d(L,{key:1},V(t.resource.data,o=>(n(),b(Me,{id:h.value,key:o.name,checkbox:t.checkbox,columns:t.columns,data:o,doctype:t.doctype,filter:t.filter,to:o.onClick},ce({_:2},[V(t.$slots,(e,y)=>({name:y,fn:P(k=>[R(t.$slots,y,ue({ref_for:!0},k))])}))]),1032,["id","checkbox","columns","data","doctype","filter","to"]))),128))],544)]),F(We,{data:t.resource.data||[]},{actions:P(o=>[R(t.$slots,"actions",de(pe(o)))]),_:3},8,["data"])]),F(Ne,{resource:t.resource},null,8,["resource"])],64))}});export{nt as _,He as u};
//# sourceMappingURL=LV.vue_vue_type_script_setup_true_lang-23701244.js.map
