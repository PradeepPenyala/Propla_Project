{"version":3,"file":"listManager-63aba0ed.js","sources":["../../../../desk/src/composables/listManager.ts"],"sourcesContent":["import { ref, watch } from \"vue\";\nimport { createListResource, createResource } from \"frappe-ui\";\n\nconst GET_LIST_METHOD = \"helpdesk.extends.client.get_list\";\nconst GET_LIST_META_METHOD = \"helpdesk.extends.client.get_list_meta\";\n\ntype ListOptions = {\n  doctype: string;\n  fields?: Array<string>;\n  filters?: object;\n  orderBy?: string;\n  pageLength?: number;\n  start?: number;\n  cache?: boolean | string | Array<string>;\n  auto?: boolean;\n  transform?: any;\n};\n\ntype MetaData = {\n  total_count: number;\n  total_pages: number;\n  current_page: number;\n  start_from: number;\n  end_at: number;\n  has_next_page: boolean;\n  has_previous_page: boolean;\n};\n\nexport function createListManager(options: ListOptions) {\n  const doctype = options.doctype;\n  const fields = options.fields;\n  const filters = options.filters;\n  const orderBy = options.orderBy;\n  const pageLength = options.pageLength;\n  const start = options.start;\n  const cache = options.cache;\n  const auto = options.auto;\n  const transform = options.transform;\n\n  const list = createListResource({\n    type: \"list\",\n    url: GET_LIST_METHOD,\n    realtime: true,\n    doctype,\n    fields,\n    orderBy,\n    filters,\n    pageLength,\n    start,\n    cache,\n    auto,\n    transform,\n    onSuccess() {\n      meta.submit({\n        doctype,\n        filters: list.filters,\n        limit: list.pageLength,\n        order_by: list.orderBy,\n        start: list.start,\n      });\n    },\n  });\n\n  Object.assign(list, {\n    totalCount: ref(0),\n    totalPages: ref(0),\n    currentPage: ref(0),\n    hasNextPage: ref(false),\n    hasPreviousPage: ref(false),\n    startFrom: ref(0),\n    endAt: ref(0),\n  });\n\n  const meta = createResource({\n    url: GET_LIST_META_METHOD,\n    onSuccess: (data: MetaData) => {\n      list.totalCount = data.total_count;\n      list.totalPages = data.total_pages;\n      list.currentPage = data.current_page;\n      list.hasNextPage = data.has_next_page;\n      list.hasPreviousPage = data.has_previous_page;\n      list.startFrom = data.start_from;\n      list.endAt = data.end_at;\n    },\n  });\n\n  watch(\n    () => list.list.loading,\n    () => {\n      list.hasPreviousPage = false;\n      list.hasNextPage = false;\n    }\n  );\n\n  return list;\n}\n"],"names":["GET_LIST_METHOD","GET_LIST_META_METHOD","createListManager","options","doctype","fields","filters","orderBy","pageLength","start","cache","auto","transform","list","createListResource","meta","ref","createResource","data","watch"],"mappings":"8DAGA,MAAMA,EAAkB,mCAClBC,EAAuB,wCAwBtB,SAASC,EAAkBC,EAAsB,CACtD,MAAMC,EAAUD,EAAQ,QAClBE,EAASF,EAAQ,OACjBG,EAAUH,EAAQ,QAClBI,EAAUJ,EAAQ,QAClBK,EAAaL,EAAQ,WACrBM,EAAQN,EAAQ,MAChBO,EAAQP,EAAQ,MAChBQ,EAAOR,EAAQ,KACfS,EAAYT,EAAQ,UAEpBU,EAAOC,EAAmB,CAC9B,KAAM,OACN,IAAKd,EACL,SAAU,GACV,QAAAI,EACA,OAAAC,EACA,QAAAE,EACA,QAAAD,EACA,WAAAE,EACA,MAAAC,EACA,MAAAC,EACA,KAAAC,EACA,UAAAC,EACA,WAAY,CACVG,EAAK,OAAO,CACV,QAAAX,EACA,QAASS,EAAK,QACd,MAAOA,EAAK,WACZ,SAAUA,EAAK,QACf,MAAOA,EAAK,KAAA,CACb,CACH,CAAA,CACD,EAED,OAAO,OAAOA,EAAM,CAClB,WAAYG,EAAI,CAAC,EACjB,WAAYA,EAAI,CAAC,EACjB,YAAaA,EAAI,CAAC,EAClB,YAAaA,EAAI,EAAK,EACtB,gBAAiBA,EAAI,EAAK,EAC1B,UAAWA,EAAI,CAAC,EAChB,MAAOA,EAAI,CAAC,CAAA,CACb,EAED,MAAMD,EAAOE,EAAe,CAC1B,IAAKhB,EACL,UAAYiB,GAAmB,CAC7BL,EAAK,WAAaK,EAAK,YACvBL,EAAK,WAAaK,EAAK,YACvBL,EAAK,YAAcK,EAAK,aACxBL,EAAK,YAAcK,EAAK,cACxBL,EAAK,gBAAkBK,EAAK,kBAC5BL,EAAK,UAAYK,EAAK,WACtBL,EAAK,MAAQK,EAAK,MACpB,CAAA,CACD,EAED,OAAAC,EACE,IAAMN,EAAK,KAAK,QAChB,IAAM,CACJA,EAAK,gBAAkB,GACvBA,EAAK,YAAc,EACrB,CAAA,EAGKA,CACT"}