import{d as D,N as x,E as $,o as i,i as c,f as m,B as M,q as T,S as w,e as V,G as z,a2 as k,O as P,a3 as K,z as O,h as t,g as v,w as C,F as R,r as q,a4 as A,v as N,a5 as Y,a6 as G,u as Q,x as J,Q as I,a7 as U,a8 as j,U as W,b as X,_ as B}from"./index-a86022ab.js";import{_ as Z,a as L,s as H}from"./TicketTextEditor.vue_vue_type_script_setup_true_lang-7bbd651c.js";import{u as ee}from"./error-90c51c34.js";import"./vuedraggable.umd-9334f31c.js";import"./iconify-6a43d462.js";import{_ as S,a as te}from"./Autocomplete-28eb1937.js";import"./Breadcrumbs.vue_vue_type_script_setup_true_lang-3ebac268.js";import"./Dropdown-068a4fad.js";import"./PageTitle.vue_vue_type_script_setup_true_lang-022e67c2.js";import"./FileUploader-c45cb8d3.js";import"./AttachmentItem.vue_vue_type_script_setup_true_lang-ae5a880a.js";import"./file-text-7a5c11aa.js";import"./TextEditor-c90c58ca.js";import"./UserAvatar.vue_vue_type_script_setup_true_lang-a7059022.js";import"./Avatar.vue_vue_type_script_setup_true_lang-f38fd5a3.js";const ae={class:"space-y-1.5"},se={class:"block text-sm text-gray-700"},oe={key:0,class:"place-self-center text-red-500"},le=D({__name:"UniInput",props:{field:{},value:{type:[String,Number,Boolean]}},emits:["change"],setup(y,{emit:_}){const e=y,f=_,r=x(()=>e.field.url_method?k(S,{options:n.data}):e.field.fieldtype==="Link"&&e.field.options?k(te,{doctype:e.field.options}):e.field.fieldtype==="Select"?k(S,{options:e.field.options.split(`
`).map(o=>({label:o,value:o}))}):e.field.fieldtype==="Check"?k(S,{options:[{label:"Yes",value:1},{label:"No",value:0}]}):k(P,{debounce:500})),n=$({url:e.field.url_method,auto:!!e.field.url_method,transform:o=>o.map(d=>({label:d,value:d}))}),s=x(()=>e.field.fieldtype==="Check"?e.value?"Yes":"No":e.value),b=x(()=>e.field.fieldtype==="Data"&&!e.field.url_method?"Type something":"Select an option");function g(o,d){f("change",{fieldname:o,value:d})}return(o,d)=>(i(),c("div",ae,[m("span",se,[M(T(o.field.label)+" ",1),o.field.required?(i(),c("span",oe," * ")):w("",!0)]),(i(),V(z(r.value),{placeholder:b.value,value:s.value,"model-value":s.value,"onUpdate:modelValue":d[0]||(d[0]=p=>g(o.field.fieldname,p)),onChange:d[1]||(d[1]=p=>g(o.field.fieldname,p.value||p))},null,40,["placeholder","value","model-value"]))]))}}),ne={key:0,class:"rounded border bg-cyan-50 px-5 py-3 text-base"},ie={class:"mb-2 font-medium"},re=m("span",{class:"text-xs"},"(View All)",-1),de={class:"space-y-2"},ue={class:"font-semibold"},ce=["innerHTML"],me=D({__name:"TicketNewArticles",props:{search:{}},setup(y){const _=y,e=$({url:"helpdesk.api.article.search",debounce:500,auto:!1});return K(()=>_.search,f=>{f.length<3||(e.update({params:{query:f}}),e.reload())}),(f,r)=>{const n=O("RouterLink");return!t(A.isEmpty)(t(e).data)&&f.search.length>2?(i(),c("div",ne,[m("div",ie,[M(" These articles may already cover what you are looking for "),v(n,{class:"group cursor-pointer space-x-1 hover:text-gray-900",to:{name:"KBHome"},target:"_blank"},{default:C(()=>[re]),_:1})]),m("dl",de,[(i(!0),c(R,null,q(t(e).data,s=>(i(),c("div",{key:s.id,class:"focus:ring-cyan-30 rounded-md border-2 border-hidden p-4 hover:bg-cyan-100 focus:outline-none focus:ring active:bg-cyan-50"},[v(n,{class:"group cursor-pointer space-x-1 hover:text-gray-900",to:{name:"KBArticlePublic",params:{articleId:s.name.split("#")[0]},hash:`#${s.name.split("#")[1]}`},target:"_blank"},{default:C(()=>[m("dt",ue,T(s.subject)+" - "+T(s.headings),1),m("dd",{class:"font-light",innerHTML:s.description},null,8,ce)]),_:2},1032,["to"])]))),128))])])):w("",!0)}}}),pe={class:"flex flex-col overflow-y-auto"},fe={key:0,class:"mx-5 my-3"},he=["innerHTML"],ve={class:"grid grid-cols-1 gap-4 px-5 sm:grid-cols-3"},_e={class:"m-5"},be={key:2,class:"mx-5 mb-5 h-full"},ge={class:"flex items-center justify-center text-lg text-gray-500"},ye={key:3,class:"mx-5 mb-5 h-full"},Le=D({__name:"TicketNew",props:{templateId:{default:""}},setup(y){const _=y,e=W(),f=X(),r=N(""),n=N(""),s=N([]),b=Y({}),g=window.location.pathname.includes("/my-tickets"),o=$({url:"helpdesk.helpdesk.doctype.hd_ticket_template.api.get_one",makeParams:()=>({name:_.templateId||"Default"}),auto:!0}),d=x(()=>o.data?.fields?.filter(u=>e.meta.agent||!u.hide_from_customer)),p=$({url:"helpdesk.helpdesk.doctype.hd_ticket.api.new",debounce:300,makeParams:()=>({doc:{description:n.value,subject:r.value,template:_.templateId,...b},attachments:s.value}),validate:u=>{const a=[...d.value?.filter(h=>h.required)||[],"subject","description"];for(const h of a)if(A.isEmpty(u.doc[h.fieldname||h]))return`${h.label||h} is required`},onSuccess:u=>{f.push({name:e.meta.onSuccessRoute,params:{ticketId:u.name}}),g&&I("new_ticket_submitted",{data:{user:E,ticketID:u.name,subject:r.value,description:n.value,customFields:b}})},onError:ee()});function F(u){return H(u,{allowedTags:H.defaults.allowedTags.concat(["img"])})}G(()=>({title:"New Ticket"}));const{userId:E}=Q();return J(()=>{I("new_ticket_page",{data:{user:E}})}),(u,l)=>(i(),c("div",pe,[v(Z,{parent:t(e).meta.parent,title:"New",current:t(e).name},null,8,["parent","current"]),t(o).data?.about?(i(),c("div",fe,[m("div",{class:"prose-f",innerHTML:F(t(o).data.about)},null,8,he)])):w("",!0),m("div",ve,[(i(!0),c(R,null,q(d.value,a=>(i(),V(t(le),{key:a.fieldname,field:a,value:b[a.fieldname],onChange:h=>b[a.fieldname]=h.value},null,8,["field","value","onChange"]))),128))]),m("div",_e,[v(t(P),{modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=a=>r.value=a),type:"text",label:"Subject*",placeholder:"A short description"},null,8,["modelValue"])]),t(g)?(i(),V(me,{key:1,search:r.value,class:"mx-5 mb-5"},null,8,["search"])):w("",!0),t(g)?(i(),c("div",be,[U(v(L,{ref:"editor",attachments:s.value,"onUpdate:attachments":l[2]||(l[2]=a=>s.value=a),content:n.value,"onUpdate:content":l[3]||(l[3]=a=>n.value=a),placeholder:"Detailed explanation",expand:""},{"bottom-right":C(()=>[v(t(B),{label:"Submit",theme:"gray",variant:"solid",disabled:u.$refs.editor.editor.isEmpty||t(p).loading||!r.value,onClick:l[1]||(l[1]=()=>t(p).submit())},null,8,["disabled"])]),_:1},8,["attachments","content"]),[[j,r.value.length>2||n.value.length>0]]),U(m("h4",ge," Please enter a subject to continue ",512),[[j,r.value.length<=2&&n.value.length===0]])])):(i(),c("div",ye,[v(L,{ref:"editor",attachments:s.value,"onUpdate:attachments":l[5]||(l[5]=a=>s.value=a),content:n.value,"onUpdate:content":l[6]||(l[6]=a=>n.value=a),placeholder:"Detailed explanation",expand:""},{"bottom-right":C(()=>[v(t(B),{label:"Submit",theme:"gray",variant:"solid",disabled:u.$refs.editor.editor.isEmpty||t(p).loading||!r.value,onClick:l[4]||(l[4]=()=>t(p).submit())},null,8,["disabled"])]),_:1},8,["attachments","content"])]))]))}});export{Le as default};
//# sourceMappingURL=TicketNew-f29d51e8.js.map
