import{an as Y,o as n,i as m,f as o,d as H,bb as P,v as k,ao as be,N as L,at as J,z as A,g as a,w as g,h as t,bc as fe,n as z,S as w,F,r as O,e as B,ai as K,E as N,ab as ae,bd as Fe,be as se,au as He,k as qe,a7 as ye,m as Ue,p as Oe,q as T,a8 as xe,l as ze,bf as ie,bg as Q,bh as ee,u as Pe,W as le,D as Ve,b9 as Ne,ba as Be,B as re,c as me,x as Se,a3 as Ae,G as he,T as ve,ad as Ze,a1 as te,a9 as Ke,bi as ne,aj as _e,a2 as X,O as ue,b8 as Ye,bj as We,y as Ge}from"./index-a86022ab.js";import{D as ce}from"./Dropdown-068a4fad.js";import{_ as Je}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-3ebac268.js";import{u as Xe,_ as Qe}from"./agent-487634f4.js";import{d as U}from"./vuedraggable.umd-9334f31c.js";import"./iconify-6a43d462.js";import{_ as et,I as we}from"./TicketAgentFields.vue_vue_type_style_index_0_scoped_1510d798_lang-6fc9a99d.js";import{_ as tt}from"./LayoutHeader-413b8747.js";import{F as Te}from"./FileUploader-c45cb8d3.js";import{T as Le,a as Ce}from"./TextEditor-c90c58ca.js";import{_ as ke}from"./AttachmentItem.vue_vue_type_script_setup_true_lang-ae5a880a.js";import{_ as de}from"./UserAvatar.vue_vue_type_script_setup_true_lang-a7059022.js";import{a as Ee,_ as oe}from"./Autocomplete-28eb1937.js";import{_ as lt}from"./StarRating.vue_vue_type_script_setup_true_lang-5c4d1ebd.js";import{_ as nt}from"./Avatar.vue_vue_type_script_setup_true_lang-f38fd5a3.js";import{u as ot}from"./ticketStatus-6f8b6098.js";import"./label-fe9568ec.js";import"./file-text-7a5c11aa.js";const at={},st={width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},it=o("path",{d:"M2.5 6.5V6.5C2.5 7.10397 2.86771 7.64708 3.42848 7.87139L9.25722 10.2029C9.73404 10.3936 10.266 10.3936 10.7428 10.2029L16.5715 7.87139C17.1323 7.64708 17.5 7.10397 17.5 6.5V6.5",stroke:"currentColor"},null,-1),rt=o("rect",{x:"2.5",y:"4",width:"15",height:"12",rx:"2.5",stroke:"currentColor"},null,-1),ut=[it,rt];function ct(e,i){return n(),m("svg",st,ut)}const $e=Y(at,[["render",ct]]),dt={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},mt=["r"],pt={__name:"DotIcon",props:{radius:{type:Number,default:3.5}},setup(e){return(i,f)=>(n(),m("svg",dt,[o("circle",{cx:"8",cy:"8",r:e.radius,fill:"currentColor"},null,8,mt)]))}},ft={},vt={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},gt=o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.00915 1.67113C6.43756 0.996093 8.0523 0.824124 9.59083 1.18318L9.47719 1.67009L9.59083 1.18318C11.1294 1.54222 12.5012 2.41118 13.4833 3.64873L13.4833 3.64875C14.4653 4.8863 14.9999 6.41969 15 7.99959V7.99961V8.64961C15 9.29937 14.7419 9.92256 14.2824 10.382C13.8229 10.8415 13.1998 11.0996 12.55 11.0996C11.9002 11.0996 11.2771 10.8415 10.8176 10.382C10.6732 10.2376 10.5487 10.077 10.4458 9.90455C9.87852 10.6319 8.99387 11.0996 8.00001 11.0996C6.28792 11.0996 4.90001 9.71167 4.90001 7.99961C4.90001 6.28752 6.28792 4.8996 8.00001 4.8996C8.81015 4.8996 9.54773 5.21039 10.1 5.71924V5.3996C10.1 5.12346 10.3239 4.8996 10.6 4.8996C10.8761 4.8996 11.1 5.12346 11.1 5.3996V7.99961V8.64961C11.1 9.03414 11.2528 9.40298 11.5247 9.67491C11.7966 9.94684 12.1654 10.0996 12.55 10.0996C12.9345 10.0996 13.3034 9.94684 13.5753 9.67491C13.8472 9.40298 14 9.03414 14 8.64961V7.99964C14 7.99963 14 7.99962 14 7.99961C13.9999 6.64545 13.5417 5.33113 12.7 4.27036C11.8582 3.20959 10.6823 2.46476 9.36356 2.15701L9.477 1.67093L9.36356 2.15701C8.04482 1.84925 6.66077 1.99665 5.43641 2.57525L5.24134 2.16246L5.43641 2.57525C4.21207 3.15384 3.21944 4.12961 2.61996 5.34387C2.02048 6.55813 1.84939 7.93946 2.13451 9.26331C2.41962 10.5871 3.14418 11.7756 4.19038 12.6354C5.23657 13.4952 6.54286 13.9758 7.89687 13.9991C9.25083 14.0224 10.5729 13.587 11.648 12.7636C11.8673 12.5958 12.1811 12.6374 12.349 12.8566C12.5169 13.0759 12.4752 13.3897 12.256 13.5576C11.0017 14.5181 9.45929 15.0261 7.87968 14.999C6.30002 14.9718 4.77601 14.4111 3.55545 13.408L3.55543 13.408C2.33489 12.4048 1.48956 11.0183 1.15692 9.47385C0.824284 7.92937 1.02389 6.31782 1.72329 4.90118L2.16883 5.12114L1.72329 4.90117C2.42268 3.48454 3.58074 2.34615 5.00915 1.67113ZM10.1 7.99961C10.1 6.83981 9.15978 5.8996 8.00001 5.8996C6.84021 5.8996 5.90001 6.8398 5.90001 7.99961C5.90001 9.15939 6.84021 10.0996 8.00001 10.0996C9.15978 10.0996 10.1 9.15939 10.1 7.99961Z",fill:"currentColor"},null,-1),yt=[gt];function xt(e,i){return n(),m("svg",vt,yt)}const bt=Y(ft,[["render",xt]]),ht={},_t={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ct=o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M8 2.5C4.2911 2.5 1.5 4.84419 1.5 7.5C1.5 9.14452 2.54729 10.6518 4.25112 11.5816C4.50048 11.7177 4.758 12.0041 4.7326 12.4082C4.71107 12.7508 4.61659 13.2533 4.47175 13.6657C4.44071 13.7541 4.40789 13.8389 4.37434 13.9195C4.62005 13.8524 4.91964 13.7411 5.26646 13.5579C5.48882 13.4404 5.69385 13.2901 5.9102 13.1207C5.95058 13.089 5.9922 13.056 6.03481 13.0222C6.20816 12.8848 6.39803 12.7342 6.58835 12.6102C6.7875 12.4803 7.01146 12.4447 7.20831 12.4631C7.46767 12.4875 7.73186 12.5 8 12.5C11.7089 12.5 14.5 10.1558 14.5 7.5C14.5 4.84419 11.7089 2.5 8 2.5ZM0.5 7.5C0.5 4.08068 3.97691 1.5 8 1.5C12.0231 1.5 15.5 4.08068 15.5 7.5C15.5 10.9193 12.0231 13.5 8 13.5C7.70158 13.5 7.40709 13.4861 7.11751 13.459C6.97583 13.5528 6.83777 13.6621 6.67569 13.7905C6.62832 13.828 6.5789 13.8671 6.52674 13.908C6.30071 14.085 6.03818 14.2812 5.73354 14.4421C4.73389 14.9702 3.9948 15.0302 3.62977 15.0147C3.39759 15.0048 3.20936 14.8646 3.12194 14.6754C3.03801 14.4938 3.05143 14.2816 3.15736 14.1099C3.24804 13.963 3.40655 13.6808 3.52825 13.3343C3.62961 13.0457 3.70134 12.6878 3.72712 12.4347C1.81521 11.3748 0.5 9.58517 0.5 7.5Z",fill:"currentColor"},null,-1),kt=[Ct];function $t(e,i){return n(),m("svg",_t,kt)}const Ie=Y(ht,[["render",$t]]),wt={},Vt={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Bt=o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M12.5684 2.50774C11.5403 1.49742 9.95026 1.49742 8.92215 2.50774L3.62404 7.71417C2.12532 9.18695 2.12532 11.669 3.62404 13.1418C5.12762 14.6194 7.66861 14.6194 9.17219 13.1418L12.1609 10.2049C12.3578 10.0113 12.6744 10.0141 12.8679 10.211C13.0615 10.408 13.0587 10.7246 12.8618 10.9181L9.8731 13.8551C7.98045 15.715 4.81578 15.715 2.92313 13.8551C1.02562 11.9904 1.02562 8.86558 2.92313 7.00091L8.22124 1.79449C9.63842 0.401838 11.8521 0.401838 13.2693 1.79449C14.6914 3.19191 14.6914 5.38225 13.2693 6.77968L13.2668 6.78213L13.2668 6.78212L8.37876 11.5189C8.37834 11.5193 8.37793 11.5197 8.37752 11.5201C7.51767 12.3638 6.11144 12.3939 5.29119 11.5097C4.43611 10.6596 4.40778 9.26893 5.30922 8.46081L7.33823 6.46692C7.53518 6.27337 7.85175 6.27613 8.04531 6.47309C8.23886 6.67005 8.23609 6.98662 8.03913 7.18017L6.0014 9.18264L5.99203 9.19185L5.98219 9.20055C5.5391 9.59243 5.5104 10.3231 6.0014 10.8056L6.01078 10.8148L6.01967 10.8245C6.42299 11.2649 7.18224 11.2926 7.67785 10.8056L7.68034 10.8032L7.68035 10.8032L12.5684 6.06643C12.5688 6.06604 12.5692 6.06565 12.5696 6.06526C13.5917 5.05969 13.5913 3.51289 12.5684 2.50774Z",fill:"currentColor"},null,-1),St=[Bt];function At(e,i){return n(),m("svg",Vt,St)}const De=Y(wt,[["render",At]]),Tt={},Lt={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Et=o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.64645 3.14645C5.84171 2.95118 6.15829 2.95118 6.35355 3.14645C6.54882 3.34171 6.54882 3.65829 6.35355 3.85355L3.20711 7H10C12.4853 7 14.5 9.01472 14.5 11.5V12C14.5 12.2761 14.2761 12.5 14 12.5C13.7239 12.5 13.5 12.2761 13.5 12V11.5C13.5 9.567 11.933 8 10 8H3.20711L6.35355 11.1464C6.54882 11.3417 6.54882 11.6583 6.35355 11.8536C6.15829 12.0488 5.84171 12.0488 5.64645 11.8536L1.64645 7.85355C1.45118 7.65829 1.45118 7.34171 1.64645 7.14645L5.64645 3.14645Z",fill:"currentColor"},null,-1),It=[Et];function Dt(e,i){return n(),m("svg",Lt,It)}const Mt=Y(Tt,[["render",Dt]]),jt={},Rt={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ft=o("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.85355 3.14645C5.65829 2.95118 5.34171 2.95118 5.14645 3.14645L1.14645 7.14645C0.951184 7.34171 0.951184 7.65829 1.14645 7.85355L5.14645 11.8536C5.34171 12.0488 5.65829 12.0488 5.85355 11.8536C6.04882 11.6583 6.04882 11.3417 5.85355 11.1464L2.20711 7.5L5.85355 3.85355C6.04882 3.65829 6.04882 3.34171 5.85355 3.14645ZM10 8C11.933 8 13.5 9.567 13.5 11.5V12C13.5 12.2761 13.7239 12.5 14 12.5C14.2761 12.5 14.5 12.2761 14.5 12V11.5C14.5 9.01472 12.4853 7 10 7H6.6728L9.81924 3.85355C10.0145 3.65829 10.0145 3.34171 9.81924 3.14645C9.62398 2.95118 9.3074 2.95118 9.11214 3.14645L5.11214 7.14645C4.91688 7.34171 4.91688 7.65829 5.11214 7.85355L9.11214 11.8536C9.3074 12.0488 9.62398 12.0488 9.81924 11.8536C10.0145 11.6583 10.0145 11.3417 9.81924 11.1464L6.6728 8H10Z",fill:"currentColor"},null,-1),Ht=[Ft];function qt(e,i){return n(),m("svg",Rt,Ht)}const Ut=Y(jt,[["render",qt]]),Ot={class:"mx-10 flex items-center gap-2 border-y py-2.5"},zt=o("span",{class:"text-xs text-gray-500"},"TO:",-1),Pt=o("span",{class:"text-xs text-gray-500"},"CC:",-1),Nt=o("span",{class:"text-xs text-gray-500"},"BCC:",-1),Zt={class:"flex flex-wrap gap-2 px-10"},Kt={class:"flex justify-between gap-2 overflow-hidden px-10 py-2.5"},Yt={class:"flex items-center overflow-x-auto"},Wt={class:"flex gap-1"},Gt={class:"mt-2 flex items-center justify-end space-x-2 sm:mt-0"},Jt=H({__name:"EmailEditor",props:P({placeholder:{type:String,default:null},editable:{type:Boolean,default:!0},doctype:{type:String,default:"HD Ticket"},toEmails:{type:Array,default:()=>[]},ccEmails:{type:Array,default:()=>[]},bccEmails:{type:Array,default:()=>[]}},{modelValue:{},modelModifiers:{}}),emits:P(["submit","discard"],["update:modelValue"]),setup(e,{expose:i,emit:f}){const p=k(null),v=k(!1),r=k(!1),u=e,l=be("emailBoxContent",""),d=L(()=>!l.value||l.value==="<p></p>"),c=f,h=J(e,"modelValue"),M=k([]),_=k([...u.toEmails]),E=k([...u.ccEmails]),y=k([...u.bccEmails]),I=k(!1),b=k(!1),C=L(()=>!!E.value?.length),s=L(()=>!!y.value?.length),j=k(null),$=k(null);function q(G){l.value=G.message,v.value=!1}function V(){N({url:"run_doc_method",makeParams:()=>({dt:u.doctype,dn:h.value.name,method:"reply_via_agent",args:{attachments:M.value.map(S=>S.name),to:_.value.join(","),cc:E.value?.join(","),bcc:y.value?.join(","),message:l.value}}),onSuccess:()=>{l.value="",c("submit"),r.value=!1}}).submit()}function x(){I.value=!I.value,I.value&&ae(()=>{j.value.setFocus()})}function R(){b.value=!b.value,b.value&&ae(()=>{$.value.setFocus()})}function W(G){M.value=M.value.filter(S=>S!==G)}function Me(G,S,Z,pe){_.value=S,E.value=Z,y.value=pe,p.value.editor.chain().clearContent().insertContent(G).focus("all").setBlockquote().insertContentAt(0,{type:"paragraph"}).focus("start").run()}const je=["Paragraph",["Heading 2","Heading 3","Heading 4","Heading 5","Heading 6"],"Separator","Bold","Italic","Separator","Bullet List","Numbered List","Separator","Align Left","Align Center","Align Right","FontColor","Separator","Image","Video","Link","Blockquote","Code","Horizontal Rule",["InsertTable","AddColumnBefore","AddColumnAfter","DeleteColumn","AddRowBefore","AddRowAfter","DeleteRow","MergeCells","SplitCell","ToggleHeaderColumn","ToggleHeaderRow","ToggleHeaderCell","DeleteTable"]];return i({addToReply:Me}),(G,S)=>{const Z=A("Button"),pe=A("FeatherIcon");return n(),m(F,null,[a(t(Ce),{ref_key:"editorRef",ref:p,"editor-class":["prose-sm max-w-none mx-10 max-h-[50vh] overflow-y-auto py-3","min-h-[7rem]"],content:t(l),"starterkit-options":{heading:{levels:[2,3,4,5,6]}},placeholder:e.placeholder,editable:e.editable,onChange:S[9]||(S[9]=D=>e.editable?l.value=D:null)},{top:g(()=>[o("div",Ot,[zt,a(t(ge),{modelValue:_.value,"onUpdate:modelValue":S[0]||(S[0]=D=>_.value=D),class:"flex-1",validate:t(fe),"error-message":D=>`${D} is an invalid email address`},null,8,["modelValue","validate","error-message"]),a(Z,{label:"CC",class:z([C.value?"bg-gray-300 hover:bg-gray-200":""]),onClick:S[1]||(S[1]=D=>x())},null,8,["class"]),a(Z,{label:"BCC",class:z([s.value?"bg-gray-300 hover:bg-gray-200":""]),onClick:S[2]||(S[2]=D=>R())},null,8,["class"])]),I.value||C.value?(n(),m("div",{key:0,class:z(["mx-10 flex items-center gap-2 py-2.5",C.value||I.value?"border-b":""])},[Pt,a(t(ge),{ref_key:"ccInput",ref:j,modelValue:E.value,"onUpdate:modelValue":S[3]||(S[3]=D=>E.value=D),class:"flex-1",validate:t(fe),"error-message":D=>`${D} is an invalid email address`},null,8,["modelValue","validate","error-message"])],2)):w("",!0),b.value||s.value?(n(),m("div",{key:1,class:z(["mx-10 flex items-center gap-2 py-2.5",s.value||b.value?"border-b":""])},[Nt,a(t(ge),{ref_key:"bccInput",ref:$,modelValue:y.value,"onUpdate:modelValue":S[4]||(S[4]=D=>y.value=D),class:"flex-1",validate:t(fe),"error-message":D=>`${D} is an invalid email address`},null,8,["modelValue","validate","error-message"])],2)):w("",!0)]),bottom:g(()=>[o("div",Zt,[(n(!0),m(F,null,O(M.value,D=>(n(),B(t(ke),{key:D.file_url,label:D.file_name},{suffix:g(()=>[a(pe,{class:"h-3.5",name:"x",onClick:K(Re=>W(D),["stop"])},null,8,["onClick"])]),_:2},1032,["label"]))),128))]),o("div",Kt,[o("div",Yt,[a(t(Le),{class:"-ml-1",buttons:je}),o("div",Wt,[a(t(Te),{"upload-args":{doctype:e.doctype,docname:e.modelValue?.name,private:!0},onSuccess:S[5]||(S[5]=D=>{M.value.push(D)})},{default:g(({openFileSelector:D})=>[a(Z,{variant:"ghost",onClick:Re=>D()},{icon:g(()=>[a(t(De),{class:"h-4"})]),_:2},1032,["onClick"])]),_:1},8,["upload-args"]),a(Z,{variant:"ghost",onClick:S[6]||(S[6]=D=>v.value=!0)},{icon:g(()=>[a(t($e),{class:"h-4"})]),_:1})])]),o("div",Gt,[a(Z,{label:"Discard",onClick:S[7]||(S[7]=()=>{E.value=[],y.value=[],C.value=!1,s.value=!1,l.value="",c("discard")})}),a(Z,{variant:"solid",disabled:d.value,loading:r.value,label:"Submit",onClick:S[8]||(S[8]=()=>{r.value=!0,V()})},null,8,["disabled","loading"])])])]),_:1},8,["content","placeholder","editable"]),a(t(sn),{modelValue:v.value,"onUpdate:modelValue":S[10]||(S[10]=D=>v.value=D),doctype:e.doctype,onApply:q},null,8,["modelValue","doctype"])],64)}}}),Xt={key:0,class:"flex flex-col gap-2"},Qt={class:"flex flex-wrap gap-2 px-10"},el={class:"flex justify-between gap-2 overflow-hidden border-t px-10 py-2.5"},tl={class:"flex items-center overflow-x-auto"},ll={class:"mt-2 flex items-center justify-end space-x-2 sm:mt-0"},nl=H({__name:"CommentTextEditor",props:P({placeholder:{type:String,default:null},editable:{type:Boolean,default:!0},doctype:{type:String,default:"HD Ticket"}},{modelValue:{},modelModifiers:{}}),emits:P(["submit","discard"],["update:modelValue"]),setup(e,{emit:i}){const{agents:f}=Xe(),p=e,v=J(e,"modelValue"),r=k([]),u=i,l=be("commentBoxContent",""),d=L(()=>!l.value||l.value==="<p></p>"),c=k(!1),h=L(()=>f.data?.map(y=>({label:y.agent_name.trimEnd(),value:y.name}))||[]);function M(y){r.value=r.value.filter(I=>I!==y)}async function _(){N({url:"run_doc_method",makeParams:()=>({dt:p.doctype,dn:v.value.name,method:"new_comment",args:{content:l.value}}),onSuccess:()=>{u("submit"),c.value=!1}}).submit()}const E=["Paragraph",["Heading 2","Heading 3","Heading 4","Heading 5","Heading 6"],"Separator","Bold","Italic","Separator","Bullet List","Numbered List","Separator","Align Left","Align Center","Align Right","FontColor","Separator","Image","Video","Link","Blockquote","Code","Horizontal Rule",["InsertTable","AddColumnBefore","AddColumnAfter","DeleteColumn","AddRowBefore","AddRowAfter","DeleteRow","MergeCells","SplitCell","ToggleHeaderColumn","ToggleHeaderRow","ToggleHeaderCell","DeleteTable"]];return(y,I)=>{const b=A("FeatherIcon"),C=A("Button");return t(f).data?(n(),B(t(Ce),{key:0,ref:"textEditor","editor-class":["prose-sm max-w-none",e.editable&&"min-h-[7rem] mx-10 max-h-[50vh] overflow-y-auto border-t py-3"],content:t(l),"starterkit-options":{heading:{levels:[2,3,4,5,6]}},placeholder:e.placeholder,editable:e.editable,mentions:h.value,onChange:I[3]||(I[3]=s=>e.editable?l.value=s:null)},{bottom:g(()=>[e.editable?(n(),m("div",Xt,[o("div",Qt,[(n(!0),m(F,null,O(r.value,s=>(n(),B(t(ke),{key:s.file_url,label:s.file_name},{suffix:g(()=>[a(b,{class:"h-3.5",name:"x",onClick:K(j=>M(s),["stop"])},null,8,["onClick"])]),_:2},1032,["label"]))),128))]),o("div",el,[o("div",tl,[a(t(Le),{class:"-ml-1",buttons:E}),a(t(Te),{"upload-args":{doctype:e.doctype,docname:e.modelValue.name,private:!0},onSuccess:I[0]||(I[0]=s=>r.value.push(s))},{default:g(({openFileSelector:s})=>[a(C,{theme:"gray",variant:"ghost",onClick:j=>s()},{icon:g(()=>[a(t(De),{class:"h-4"})]),_:2},1032,["onClick"])]),_:1},8,["upload-args"])]),o("div",ll,[a(C,{label:"Discard",onClick:I[1]||(I[1]=()=>{l.value="",u("discard")})}),a(C,{variant:"solid",label:"Submit",disabled:d.value,loading:c.value,onClick:I[2]||(I[2]=()=>{c.value=!0,_(),l.value=""})},null,8,["disabled","loading"])])])])):w("",!0)]),_:1},8,["editor-class","content","placeholder","editable","mentions"])):w("",!0)}}}),ol={class:"flex flex-wrap gap-1"},al={class:"flex-1"},sl={class:"mt-1 rounded-lg bg-white py-1 text-base shadow-2xl"},il={class:"flex flex-col gap-1 p-1 text-gray-800"},rl={class:"text-base font-medium"},ul={class:"text-sm text-gray-600"},ge=H({__name:"MultiSelectInput",props:P({validate:{type:Function,default:null},errorMessage:{type:Function,default:e=>`${e} is an Invalid value`}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:i}){const f=e,p=J(e,"modelValue"),v=k([]),r=k(null),u=k(null),l=k(""),d=k(""),c=k(!1),h=L({get:()=>l.value||"",set:s=>{l.value="",s&&(c.value=!1),s?.value&&y(s.value)}});Fe(l,s=>{s=s||"",d.value!==s&&(d.value=s,E(s))},{debounce:300,immediate:!0});const M=N({url:"frappe.desk.search.search_link",method:"POST",cache:[d.value,"Contact"],params:{txt:d.value,doctype:"Contact"},transform:s=>s.filter($=>$.description.split(", ")[1]).map($=>{let q=$.description.split(", ")[1];return{label:$.label||q,value:q}})}),_=L(()=>{let s=M.data||[];return!s.length&&l.value&&s.push({label:l.value,value:l.value}),s});function E(s){M.update({params:{txt:s,doctype:"Contact"}}),M.reload()}const y=s=>{u.value=null,s&&(s.split(",").forEach($=>{if($=$.trim(),$&&!p.value?.includes($)){if($&&f.validate&&!f.validate($)){u.value=f.errorMessage($);return}p.value?p.value.push($):p.value=[$],$=$.replace($,"")}}),!u.value&&(s=""))},I=s=>{p.value=p.value.filter(j=>j!==s)},b=()=>{if(l.value)return;let s=v.value[v.value.length-1]?.$el;document.activeElement===s?(p.value.pop(),ae(()=>{p.value.length?(s=v.value[v.value.length-1].$el,s?.focus()):C()})):s?.focus()};function C(){r.value.$el.focus()}return i({setFocus:C}),(s,j)=>{const $=A("FeatherIcon"),q=A("Button"),V=A("ErrorMessage");return n(),m("div",null,[o("div",ol,[(n(!0),m(F,null,O(p.value,x=>(n(),B(q,{ref_for:!0,ref_key:"emails",ref:v,key:x,label:x,theme:"gray",variant:"subtle",class:"rounded-full",onKeydownCapture:se(K(b,["stop"]),["delete"])},{suffix:g(()=>[a($,{class:"h-3.5",name:"x",onClick:K(R=>I(x),["stop"])},null,8,["onClick"])]),_:2},1032,["label","onKeydownCapture"]))),128)),o("div",al,[a(t(ze),{modelValue:h.value,"onUpdate:modelValue":j[2]||(j[2]=x=>h.value=x),nullable:""},{default:g(()=>[a(t(He),{show:c.value,"onUpdate:show":j[1]||(j[1]=x=>c.value=x),class:"w-full"},{target:g(({togglePopover:x})=>[a(t(qe),{ref_key:"search",ref:r,class:"search-input form-input w-full border-none bg-white hover:bg-white focus:border-none focus:!shadow-none focus-visible:!ring-0",type:"text",value:l.value,autocomplete:"off",onChange:j[0]||(j[0]=R=>{l.value=R.target.value,c.value=!0}),onFocus:()=>x(),onKeydownCapture:se(K(b,["stop"]),["delete"])},null,8,["value","onFocus","onKeydownCapture"])]),body:g(({isOpen:x})=>[ye(o("div",null,[o("div",sl,[a(t(Ue),{class:"my-1 max-h-[12rem] overflow-y-auto px-1.5",static:""},{default:g(()=>[(n(!0),m(F,null,O(_.value,R=>(n(),B(t(Oe),{key:R.value,value:R},{default:g(({active:W})=>[o("li",{class:z(["flex cursor-pointer items-center rounded px-2 py-1 text-base",{"bg-gray-100":W}])},[a(t(de),{class:"mr-2",name:R.value,size:"lg"},null,8,["name"]),o("div",il,[o("div",rl,T(R.label),1),o("div",ul,T(R.value),1)])],2)]),_:2},1032,["value"]))),128))]),_:1})])],512),[[xe,x]])]),_:1},8,["show"])]),_:1},8,["modelValue"])])]),u.value?(n(),B(V,{key:0,class:"mt-2 pl-2",message:u.value},null,8,["message"])):w("",!0)])}}}),cl={class:"flex justify-between gap-3 border-t px-10 py-2.5"},dl={class:"flex gap-1.5"},ml=H({__name:"CommunicationArea",props:P({doctype:{type:String,default:"HD Ticket"},toEmails:{type:Array,default:()=>[]},ccEmails:{type:Array,default:()=>[]},bccEmails:{type:Array,default:()=>[]}},{content:{},contentModifiers:{},modelValue:{},modelModifiers:{}}),emits:P(["update"],["update:content","update:modelValue"]),setup(e,{expose:i,emit:f}){const p=J(e,"content"),v=k(!1),r=k(!1),u=J(e,"modelValue"),l=k([]),d=f,c=k(null);function h(){r.value&&(r.value=!1),v.value=!v.value}function M(){v.value&&(v.value=!1),r.value=!r.value}function _(E){v.value=!0,c.value.addToReply(E.content,E.to?.split(","),E.cc?.split(","),E.bcc?.split(","))}return i({replyToEmail:_,toggleEmailBox:h}),(E,y)=>{const I=A("Button");return n(),m(F,null,[o("div",cl,[o("div",dl,[a(I,{ref:"sendEmailRef",variant:"ghost",label:"Reply",class:z([v.value?"!bg-gray-300 hover:!bg-gray-200":""]),onClick:y[0]||(y[0]=b=>h())},{prefix:g(()=>[a(t($e),{class:"h-4"})]),_:1},8,["class"]),a(I,{variant:"ghost",label:"Comment",class:z([r.value?"!bg-gray-300 hover:!bg-gray-200":""]),onClick:y[1]||(y[1]=b=>M())},{prefix:g(()=>[a(t(Ie),{class:"h-4"})]),_:1},8,["class"])])]),ye(o("div",null,[a(t(nl),{modelValue:u.value,"onUpdate:modelValue":y[2]||(y[2]=b=>u.value=b),attachments:l.value,"onUpdate:attachments":y[3]||(y[3]=b=>l.value=b),editable:r.value,doctype:e.doctype,placeholder:"Add a comment...",onSubmit:y[4]||(y[4]=()=>{r.value=!1,d("update")}),onDiscard:y[5]||(y[5]=()=>{r.value=!1})},null,8,["modelValue","attachments","editable","doctype"])],512),[[xe,r.value]]),ye(o("div",{class:"flex gap-1.5",onKeydownCapture:[y[11]||(y[11]=se(K((...b)=>E.submitEmail&&E.submitEmail(...b),["ctrl","stop"]),["enter"])),y[12]||(y[12]=se(K((...b)=>E.submitEmail&&E.submitEmail(...b),["meta","stop"]),["enter"]))]},[a(t(Jt),{ref_key:"emailEditorRef",ref:c,modelValue:u.value,"onUpdate:modelValue":y[6]||(y[6]=b=>u.value=b),content:p.value,"onUpdate:content":y[7]||(y[7]=b=>p.value=b),attachments:l.value,"onUpdate:attachments":y[8]||(y[8]=b=>l.value=b),"to-emails":e.toEmails,"cc-emails":e.ccEmails,"bcc-emails":e.bccEmails,onSubmit:y[9]||(y[9]=()=>{v.value=!1,d("update")}),onDiscard:y[10]||(y[10]=()=>{v.value=!1})},null,8,["modelValue","content","attachments","to-emails","cc-emails","bcc-emails"])],544),[[xe,v.value]])],64)}}}),pl={class:"grow cursor-pointer rounded-md border-transparent bg-gray-50 text-base leading-6 transition-all duration-300 ease-in-out"},fl={class:"mb-1 flex items-center justify-between gap-2"},vl={class:"flex items-center gap-2"},gl=o("span",null,"·",-1),yl={class:"text-sm text-gray-600"},xl={class:"flex gap-0.5"},bl={class:"text-sm leading-5 text-gray-600"},hl={class:"mb-3 text-sm leading-5 text-gray-600"},_l={key:0,class:"text-2xs mr-1 font-bold text-gray-500"},Cl={key:1},kl={key:2},$l={key:3,class:"text-2xs mr-1 font-bold text-gray-500"},wl={key:4},Vl={key:5},Bl={key:6,class:"text-2xs mr-1 font-bold text-gray-500"},Sl={key:7},Al=["innerHTML"],Tl={class:"flex flex-wrap gap-2"},Ll=H({__name:"EmailBox",props:{sender:{type:Object,required:!0},to:{type:String,default:null},cc:{type:String,default:null},bcc:{type:String,default:null},creation:{type:String,required:!0},subject:{type:String,required:!0},attachments:{type:Array,default:()=>[]},content:{type:String,required:!0}},emits:["reply"],setup(e,{emit:i}){const f=i;return(p,v)=>{const r=A("Tooltip"),u=A("Button");return n(),m("div",pl,[o("div",fl,[o("div",vl,[a(t(de),{name:e.sender.name,size:"md"},null,8,["name"]),o("span",null,T(e.sender.full_name),1),gl,a(r,{text:t(Q)(e.creation,t(ee))},{default:g(()=>[o("div",yl,T(t(ie)(e.creation)),1)]),_:1},8,["text"])]),o("div",xl,[a(u,{variant:"ghost",class:"text-gray-700",onClick:v[0]||(v[0]=l=>f("reply",{content:e.content,to:e.sender.name}))},{default:g(()=>[a(t(Mt),{class:"h-4 w-4"})]),_:1}),a(u,{variant:"ghost",class:"text-gray-700",onClick:v[1]||(v[1]=l=>f("reply",{content:e.content,to:e.to??e.sender.name,cc:e.cc,bcc:e.bcc}))},{default:g(()=>[a(t(Ut),{class:"h-4 w-4"})]),_:1})])]),o("div",bl,T(e.subject),1),o("div",hl,[e.to?(n(),m("span",_l,"TO:")):w("",!0),e.to?(n(),m("span",Cl,T(e.to),1)):w("",!0),e.cc?(n(),m("span",kl,", ")):w("",!0),e.cc?(n(),m("span",$l," CC: ")):w("",!0),e.cc?(n(),m("span",wl,T(e.cc),1)):w("",!0),e.bcc?(n(),m("span",Vl,", ")):w("",!0),e.bcc?(n(),m("span",Bl," BCC: ")):w("",!0),e.bcc?(n(),m("span",Sl,T(e.bcc),1)):w("",!0)]),o("div",{class:"email-content prose-f max-h-[500px] overflow-y-auto",innerHTML:e.content},null,8,Al),o("div",Tl,[(n(!0),m(F,null,O(e.attachments,l=>(n(),B(t(ke),{key:l.file_url,label:l.file_name,url:l.file_url},null,8,["label","url"]))),128))])])}}}),El={class:"flex-col text-base"},Il={class:"mb-0.5 flex items-center justify-between"},Dl={class:"text-gray-600"},Ml={class:"font-medium text-gray-800"},jl=o("span",null," added a",-1),Rl=o("span",{class:"max-w-xs truncate font-medium text-gray-800"}," comment ",-1),Fl=o("span",{class:"px-1"},"·",-1),Hl={class:"pl-0.5 text-sm"},ql={key:0,class:"px-4"},Ul=["innerHTML"],Ol=H({__name:"CommentBox",props:{name:{type:String,required:!0},creation:{type:String,required:!0},content:{type:String,required:!0},commenter:{type:String,required:!0},commentedBy:{type:String,required:!0}},emits:["update"],setup(e,{emit:i}){const f=Pe(),p=e,v=i,r=k(!1),u=N({url:"frappe.client.delete",makeParams:()=>({doctype:"HD Ticket Comment",name:p.name}),onSuccess(){v("update"),le({title:"Comment deleted",icon:"check",iconClasses:"text-green-500"})}});return(l,d)=>{const c=A("Tooltip"),h=A("Button");return n(),m(F,null,[o("div",El,[o("div",Il,[o("div",Dl,[o("span",Ml,T(e.commenter),1),jl,Rl,Fl,a(c,{text:t(Q)(e.creation,t(ee))},{default:g(()=>[o("span",Hl,T(t(ie)(e.creation)),1)]),_:1},8,["text"])]),t(f).userId===e.commentedBy?(n(),m("div",ql,[a(t(ce),{options:[{label:"Delete",onClick:()=>r.value=!0}]},{default:g(()=>[a(h,{icon:"more-horizontal",class:"text-gray-600",variant:"ghost"})]),_:1},8,["options"])])):w("",!0)]),o("div",{class:"prose-f grow cursor-pointer rounded bg-gray-50 px-4 py-3 text-base leading-6 transition-all duration-300 ease-in-out",innerHTML:e.content},null,8,Ul)]),a(t(Ve),{modelValue:r.value,"onUpdate:modelValue":d[0]||(d[0]=M=>r.value=M),options:{title:"Delete Comment",message:"Are you sure you want to confirm this action?",actions:[{label:"Cancel",onClick:()=>r.value=!1},{label:"Delete",onClick:()=>t(u).submit(),variant:"solid"}]}},null,8,["modelValue","options"])],64)}}}),zl={class:"mt-1.5 flex justify-between text-base"},Pl={class:"text-gray-600"},Nl={class:"font-medium text-gray-800"},Zl={class:"text-gray-600"},Kl={key:0},Yl={class:"text-gray-600"},Wl={class:"font-medium text-gray-800"},Gl={class:"text-gray-600"},Jl=H({__name:"HistoryBox",props:{user:{type:String,required:!0},content:{type:String,required:!0},creation:{type:String,required:!0},relatedActivities:{type:Array,default:()=>[]}},setup(e){let i=k(!1);return(f,p)=>{const v=A("Tooltip"),r=A("FeatherIcon"),u=A("Button");return n(),m(F,null,[o("div",zl,[o("div",Pl,[o("span",Nl,T(e.user),1),o("span",null,T(e.content),1)]),a(v,{text:t(Q)(e.creation,t(ee))},{default:g(()=>[o("div",Zl,T(t(ie)(e.creation)),1)]),_:1},8,["text"])]),t(i)?(n(),m("div",Kl,[(n(!0),m(F,null,O(e.relatedActivities,l=>(n(),m("div",{key:l.creation,class:"mt-2 flex justify-between text-base"},[o("div",Yl,[o("span",Wl,T(l.user),1),o("span",null,T(l.content),1)]),a(v,{text:t(Q)(l.creation,t(ee))},{default:g(()=>[o("div",Gl,T(t(ie)(l.creation)),1)]),_:2},1032,["text"])]))),128))])):w("",!0),e.relatedActivities.length?(n(),B(u,{key:1,label:t(i)?"Hide":`${e.relatedActivities.length} other activities`,variant:"outline",class:"mt-2",onClick:p[0]||(p[0]=l=>Ne(i)?i.value=!t(i):i=!t(i))},{suffix:g(()=>[a(r,{name:t(i)?"chevron-up":"chevron-down",class:"h-4 text-gray-600"},null,8,["name"])]),_:1},8,["label"])):w("",!0)],64)}}}),Xl={class:"mt-3 flex flex-wrap items-center gap-2"},Ql=H({__name:"AssignmentModal",props:P({assignees:{type:Array,required:!0},doctype:{type:String,required:!0},docname:{type:String,required:!0}},{modelValue:{},modelModifiers:{}}),emits:P(["update"],["update:modelValue"]),setup(e,{emit:i}){const f=e,p=J(e,"modelValue"),v=i,{getUser:r}=Be(),u=k(""),l=c=>{u.value="",N({url:"frappe.desk.form.assign_to.add",auto:!0,params:{doctype:f.doctype,name:f.docname,assign_to:[c]},onSuccess:()=>{v("update")}}),v("update")},d=c=>{N({url:"frappe.desk.form.assign_to.remove",auto:!0,params:{doctype:f.doctype,name:f.docname,assign_to:c},onSuccess:()=>{v("update")}})};return(c,h)=>{const M=A("Tooltip"),_=A("FeatherIcon"),E=A("Button"),y=A("ErrorMessage"),I=A("Dialog");return n(),B(I,{modelValue:p.value,"onUpdate:modelValue":h[1]||(h[1]=b=>p.value=b),options:{title:"Assign To",size:"xl"}},{"body-content":g(()=>[a(t(Ee),{class:"form-control",value:"",doctype:"HD Agent","reset-input":!0,onChange:h[0]||(h[0]=b=>{l(b.value)})},{"item-prefix":g(({option:b})=>[a(t(de),{class:"mr-2",name:b.value,size:"sm"},null,8,["name"])]),"item-label":g(({option:b})=>[a(M,{text:b.value},{default:g(()=>[re(T(t(r)(b.value).full_name),1)]),_:2},1032,["text"])]),_:1}),o("div",Xl,[(n(!0),m(F,null,O(e.assignees,b=>(n(),B(M,{key:b.name,text:b.name},{default:g(()=>[a(E,{label:t(r)(b.name).full_name,theme:"gray",variant:"outline"},{prefix:g(()=>[a(t(de),{name:b.name,size:"sm"},null,8,["name"])]),suffix:g(()=>[a(_,{class:"h-3.5",name:"x",onClick:K(C=>d(b.name),["stop"])},null,8,["onClick"])]),_:2},1032,["label"])]),_:2},1032,["text"]))),128))]),u.value?(n(),B(y,{key:0,class:"mt-2",message:u.value},null,8,["message"])):w("",!0)]),_:1},8,["modelValue"])}}}),en={key:0,class:"mt-2 grid max-h-[560px] grid-cols-3 gap-2 overflow-y-auto"},tn=["onClick"],ln={class:"border-b pb-2 text-base font-semibold"},nn={key:1,class:"mt-2"},on=o("div",{class:"flex h-56 flex-col items-center justify-center"},[o("div",{class:"text-lg text-gray-500"},T("No templates found"))],-1),an=[on],sn={__name:"CannedResponseSelectorModal",props:P({doctype:{type:String,default:""}},{modelValue:{},modelModifiers:{}}),emits:P(["apply"],["update:modelValue"]),setup(e,{emit:i}){const f=e,p=J(e,"modelValue"),v=k(""),r=i,u=k(""),l=me({type:"list",doctype:"HD Canned Response",cache:["cannedResponses",f.doctype],fields:["title","message","modified"],orderBy:"modified desc",pageLength:99999});Se(()=>{l.data==null&&l.fetch()});const d=L(()=>l.data?.filter(c=>c.title.toLowerCase().includes(u.value.toLowerCase()))??[]);return Ae(p,c=>c&&ae(()=>v.value?.el?.focus())),(c,h)=>{const M=A("FeatherIcon"),_=A("TextInput"),E=A("Dialog");return n(),B(E,{modelValue:p.value,"onUpdate:modelValue":h[1]||(h[1]=y=>p.value=y),options:{title:"Canned Responses",size:"4xl"}},{"body-content":g(()=>[a(_,{ref_key:"searchInput",ref:v,modelValue:u.value,"onUpdate:modelValue":h[0]||(h[0]=y=>u.value=y),type:"text",placeholder:"Site Down"},{prefix:g(()=>[a(M,{name:"search",class:"h-4 w-4 text-gray-500"})]),_:1},8,["modelValue"]),d.value.length?(n(),m("div",en,[(n(!0),m(F,null,O(d.value,y=>(n(),m("div",{key:y.name,class:"flex h-56 cursor-pointer flex-col gap-2 rounded-lg border p-3 hover:bg-gray-100",onClick:I=>r("apply",y)},[o("div",ln,T(y.title),1),y.message?(n(),B(t(Ce),{key:0,content:y.message,editable:!1,"editor-class":"!prose-sm max-w-none !text-sm text-gray-600 focus:outline-none",class:"flex-1 overflow-hidden"},null,8,["content"])):w("",!0)],8,tn))),128))])):(n(),m("div",nn,an))]),_:1},8,["modelValue"])}}},rn={class:"h-screen overflow-y-auto py-3.5"},un={class:"flex gap-4 px-6"},cn={class:"mb-4 w-full max-w-[742px]"},dn=H({__name:"TicketAgentActivities",props:{activities:{type:Array,required:!0}},emits:["email:reply","update"],setup(e,{expose:i,emit:f}){const p=f;function v(u){return u==="email"?bt:u==="comment"?Ie:pt}function r(){setTimeout(()=>{let u,l=document.getElementsByClassName("activity");u=l[l.length-1],u&&!Ze(u).value&&(u.scrollIntoView({behavior:"smooth"}),u.focus())},500)}return i({scrollToLatestActivity:r}),(u,l)=>(n(),m("div",rn,[(n(!0),m(F,null,O(e.activities,(d,c)=>(n(),m("div",{key:d.key,class:"activity"},[o("div",un,[o("div",{class:z(["relative flex justify-center after:absolute after:left-[50%] after:top-0 after:-z-10 after:border-l after:border-gray-200",[c!=e.activities.length-1?"after:h-full":"after:h-4"]])},[o("div",{class:z(["z-10 flex h-7 w-7 items-center justify-center rounded-full bg-gray-100",[d.type==="history"?"bg-white":"bg-gray-100",d.type==="comment"?"mt-0.5":"",d.type==="email"?"mt-2":""]])},[(n(),B(he(v(d.type)),{class:z([d.type=="history"?"text-gray-600":"text-gray-800"])},null,8,["class"]))],2)],2),o("div",cn,[d.type==="email"?(n(),B(t(Ll),ve({key:0,ref_for:!0},d,{onReply:l[0]||(l[0]=h=>p("email:reply",h))}),null,16)):d.type==="comment"?(n(),B(t(Ol),ve({key:1,ref_for:!0},d,{onUpdate:l[1]||(l[1]=()=>p("update"))}),null,16)):(n(),B(t(Jl),ve({key:2,ref_for:!0},d),null,16))])])]))),128))]))}}),mn={class:"flex flex-col gap-3 border-b px-6 py-3"},pn={class:"w-[126px] text-sm text-gray-600"},fn={class:"flex items-center justify-between"},vn={key:0},gn=H({__name:"TicketAgentDetails",props:{agreementStatus:{type:String,required:!0},ticketCreatedOn:{type:String,required:!0},firstRespondedOn:{type:String,required:!0},responseBy:{type:String,required:!0},resolutionDate:{type:String,required:!0},resolutionBy:{type:String,required:!0},source:{type:String,required:!0}},setup(e){const i=e,f=L(()=>{let r=null;return!i.firstRespondedOn&&U().isBefore(U(i.responseBy))?r={label:`Due in ${ne(U(i.responseBy).diff(U(),"s"))}`,color:"orange"}:U(i.firstRespondedOn).isBefore(U(i.responseBy))?r={label:`Fulfilled in ${ne(U(i.firstRespondedOn).diff(U(i.ticketCreatedOn),"s"))}`,color:"green"}:r={label:"Failed",color:"red"},r}),p=L(()=>{let r=null;return!i.resolutionDate&&U().isBefore(i.resolutionBy)?r={label:`Due in ${ne(U(i.resolutionBy).diff(U(),"s"))}`,color:"orange"}:U(i.resolutionDate).isBefore(i.resolutionBy)?r={label:`Fulfilled in ${ne(U(i.resolutionDate).diff(U(i.ticketCreatedOn),"s"))}`,color:"green"}:r={label:"Failed",color:"red"},r}),v=L(()=>[{label:"First Response",tooltipValue:Q(i.firstRespondedOn||i.responseBy,ee),badgeText:f.value.label,badgeColor:f.value.color},{label:"Resolution",tooltipValue:Q(i.resolutionDate||i.resolutionBy,ee),badgeText:p.value.label,badgeColor:p.value.color},{label:"Source",value:i.source}]);return(r,u)=>(n(),m("div",mn,[(n(!0),m(F,null,O(v.value,l=>(n(),m("div",{key:l.label,class:"flex items-center text-base leading-5"},[a(t(te),{text:l.label},{default:g(()=>[o("div",pn,T(l.label),1)]),_:2},1032,["text"]),o("div",fn,[l.value?(n(),m("div",vn,T(l.value),1)):w("",!0),a(t(te),{text:l.tooltipValue},{default:g(()=>[l.badgeText?(n(),B(t(Ke),{key:0,class:"-ml-1",label:l.badgeText,variant:"subtle",theme:l.badgeColor},null,8,["label","theme"])):w("",!0)]),_:2},1032,["text"])])]))),128))]))}}),yn={class:"flex items-center justify-start gap-5 border-b p-5"},xn={class:"flex flex-col gap-2.5"},bn={class:"w-[242px] truncate text-2xl font-medium"},hn={class:"flex gap-1.5"},_n=H({__name:"TicketAgentContact",props:{contact:{type:Object,required:!0}},emits:["email:open"],setup(e,{emit:i}){const f=e,p=i;function v(){p("email:open",f.contact.email_id)}return(r,u)=>{const l=A("Button");return n(),m("div",yn,[a(t(nt),{size:"3xl",class:"h-[88px] w-[88px]",image:e.contact.image,label:e.contact.name},null,8,["image","label"]),o("div",xn,[a(t(te),{text:e.contact.name},{default:g(()=>[o("div",bn,T(e.contact.name),1)]),_:1},8,["text"]),o("div",hn,[a(t(te),{text:e.contact.email_id},{default:g(()=>[a(l,{class:"h-7 w-7"},{default:g(()=>[a(t($e),{class:"h-4 w-4",onClick:u[0]||(u[0]=d=>v())})]),_:1})]),_:1},8,["text"])])])])}}}),Cn=_e("team",()=>{const e=me({doctype:"HD Team",auto:!0,pageLength:99999}),i=L(()=>e.list?.data||[]);return{dropdown:L(()=>i.value.map(p=>({label:p.name,value:p.name}))),options:i}}),kn=_e("ticketPriority",()=>{const e=me({doctype:"HD Ticket Priority",orderBy:"integer_value desc",auto:!0,pageLength:99999}),i=L(()=>e.list?.data||[]),f=L(()=>i.value.map(r=>({label:r.name,value:r.name}))),p=L(()=>i.value.map(r=>r.name));return{colorMap:{Urgent:"red",High:"orange",Medium:"blue",Low:"green"},dropdown:f,names:p,options:i}}),$n=_e("ticketType",()=>{const e=me({doctype:"HD Ticket Type",fields:["*"],auto:!0,pageLength:99999}),i=L(()=>e.list?.data||[]);return{dropdown:L(()=>i.value.map(p=>({label:p.name,value:p.name}))),options:i}}),wn={class:"flex items-center gap-2 px-6 pb-1 leading-5 first:mt-3"},Vn={class:"w-[106px] shrink-0 truncate text-sm text-gray-600"},Bn={key:0,class:"text-red-500"},Sn={class:"-m-0.5 min-h-[28px] flex-1 items-center overflow-hidden p-0.5 text-base"},An=H({__name:"UniInput2",props:{field:{},value:{type:[String,Number,Boolean]}},emits:["change"],setup(e,{emit:i}){const f=e,p=i,v=L(()=>f.field.url_method?X(oe,{options:r.data}):f.field.fieldtype==="Link"&&f.field.options?X(Ee,{doctype:f.field.options}):f.field.fieldtype==="Select"?X(oe,{options:f.field.options.split(`
`).map(d=>({label:d,value:d}))}):f.field.fieldtype==="Check"?X(oe,{options:[{label:"Yes",value:1},{label:"No",value:0}]}):X(ue)),r=N({url:f.field.url_method,auto:!!f.field.url_method,transform:d=>d.map(c=>({label:c,value:c}))}),u=L(()=>f.field.fieldtype==="Check"?f.value?"Yes":"No":f.value);function l(d,c){p("change",{fieldname:d,value:c})}return(d,c)=>(n(),m("div",wn,[a(t(te),{text:d.field.label},{default:g(()=>[o("div",Vn,[re(T(d.field.label)+" ",1),d.field.required?(n(),m("span",Bn," * ")):w("",!0)])]),_:1},8,["text"]),o("div",Sn,[(n(),B(he(v.value),{key:u.value,class:"form-control",placeholder:`Add ${d.field.label}`,value:u.value,onChange:c[0]||(c[0]=h=>l(d.field.fieldname,h.value||h.target.value))},null,40,["placeholder","value"]))])]))}}),Tn=Y(An,[["__scopeId","data-v-91843cf8"]]),Ln={class:"flex flex-1 flex-col overflow-hidden overflow-y-auto border-b"},En={class:"w-[106px] shrink-0 truncate text-sm text-gray-600"},In={class:"-m-0.5 min-h-[28px] flex-1 items-center overflow-hidden p-0.5 text-base"},Dn=H({__name:"TicketAgentFields",props:{ticket:{type:Object,required:!0}},emits:["update"],setup(e,{emit:i}){const f=i,p=e,v=N({url:"helpdesk.utils.get_customer",params:{contact:p.ticket.raised_by},auto:!0,transform:l=>l.map(d=>({label:d,value:d}))}),r=L(()=>[{field:"ticket_type",label:"Ticket type",store:$n()},{field:"priority",label:"Priority",store:kn()},{field:"agent_group",label:"Team",store:Cn()},{field:"customer",label:"Customer",type:"select",placeholder:"Select Customer"},{field:"subject",label:"Subject",type:"textarea",placeholder:"Problem in XYZ"}]);function u(l,d,c=null){if(l==="subject"&&d===""){le({title:"Subject is required",icon:"x",iconClasses:"text-red-600"}),c.target.value=p.ticket.subject;return}f("update",{field:l,value:d})}return(l,d)=>(n(),m("div",Ln,[(n(!0),m(F,null,O(r.value,c=>(n(),m("div",{key:c.field,class:"flex items-center gap-2 px-6 pb-1 leading-5 first:mt-3"},[a(t(te),{text:c.label},{default:g(()=>[o("div",En,T(c.label),1)]),_:2},1032,["text"]),o("div",In,[c.type==="textarea"?(n(),B(t(ue),{key:0,class:"form-control",type:c.type,value:e.ticket[c.field],variant:"subtle",rows:"2",onChange:h=>u(c.field,h.target.value,h)},null,8,["type","value","onChange"])):c.type==="select"?(n(),B(t(ue),{key:1,class:"form-control",type:c.type,value:e.ticket[c.field],options:t(v)?.data,onChange:h=>u(c.field,h.target.value)},null,8,["type","value","options","onChange"])):(n(),B(t(oe),{key:2,class:"form-control",options:c.store.dropdown,placeholder:`Add ${c.label}`,value:e.ticket[c.field],onChange:h=>u(c.field,h.value)},null,8,["options","placeholder","value","onChange"]))])]))),128)),(n(!0),m(F,null,O(e.ticket.template.fields,c=>(n(),B(Tn,{key:c.fieldname,field:c,value:e.ticket[c.fieldname],onChange:d[0]||(d[0]=h=>u(h.fieldname,h.value))},null,8,["field","value"]))),128))]))}}),Mn=Y(Dn,[["__scopeId","data-v-1510d798"]]),jn={class:"flex w-[382px] flex-col justify-between border-l"},Rn={class:"h-10.5 flex items-center justify-between border-b px-5 py-2.5"},Fn={key:0,class:"border-b px-6 py-3 text-base text-gray-600"},Hn={class:"flex"},qn=o("div",{class:"min-w-[106px] pb-1.5"},"Rating",-1),Un={class:"px-1.5"},On={class:"flex"},zn=o("div",{class:"w-[106px] pb-1.5"},"Feedback",-1),Pn={class:"px-1.5 text-gray-800"},Nn={key:0,class:"flex"},Zn=o("div",{class:"min-w-[106px] pb-1.5"},"Comment",-1),Kn={class:"px-1.5 text-gray-800"},Yn=H({__name:"TicketAgentSidebar",props:{ticket:{type:Object,required:!0}},emits:["update","email:open"],setup(e,{emit:i}){const f=e,p=i;function v(u){p("update",u)}function r(){navigator.clipboard.writeText(`${f.ticket.name}`),le({title:"Copied to clipboard",text:f.ticket.name,icon:"check",iconClasses:"text-green-600"})}return(u,l)=>(n(),m("div",jn,[o("div",Rn,[o("span",{class:"cursor-copy text-lg font-semibold",onClick:l[0]||(l[0]=d=>r())},"#"+T(e.ticket.name),1)]),a(_n,{contact:e.ticket.contact,"onEmail:open":l[1]||(l[1]=d=>p("email:open",d))},null,8,["contact"]),e.ticket.feedback_rating?(n(),m("div",Fn,[o("div",Hn,[qn,o("div",Un,[a(t(lt),{rating:e.ticket.feedback_rating},null,8,["rating"])])]),o("div",On,[zn,o("div",Pn,T(e.ticket.feedback_text),1)]),e.ticket.feedback_extra?(n(),m("div",Nn,[Zn,o("div",Kn,T(e.ticket.feedback_extra),1)])):w("",!0)])):w("",!0),a(gn,{"agreement-status":e.ticket.agreement_status,"first-responded-on":e.ticket.first_responded_on,"response-by":e.ticket.response_by,"resolution-date":e.ticket.resolution_date,"resolution-by":e.ticket.resolution_by,"ticket-created-on":e.ticket.creation,source:e.ticket.via_customer_portal?"Portal":"Mail"},null,8,["agreement-status","first-responded-on","response-by","resolution-date","resolution-by","ticket-created-on","source"]),a(Mn,{ticket:e.ticket,onUpdate:v},null,8,["ticket"])]))}}),Wn={key:0},Gn={key:2},Jn={__name:"CustomActions",props:{actions:{type:Object,required:!0}},setup(e){const i=e,f=L(()=>i.actions.filter(r=>!r.group)),p=L(()=>{let r=[];return i.actions.filter(u=>u.buttonLabel&&u.group).forEach(u=>{let l=r.findIndex(d=>d.label===u.buttonLabel);l>-1?r[l].action.push(u):r.push({label:u.buttonLabel,action:[u]})}),r}),v=L(()=>{let r=[];return r=r.concat(i.actions.filter(u=>u.group&&!u.buttonLabel)),r});return(r,u)=>{const l=A("FeatherIcon"),d=A("Button");return n(),m(F,null,[f.value.length?(n(),m("div",Wn,[(n(!0),m(F,null,O(f.value,c=>(n(),B(d,{key:c.label,label:c.label,onClick:h=>c.onClick()},Ye({_:2},[c.icon?{name:"prefix",fn:g(()=>[a(l,{name:c.icon,class:"h-4 w-4"},null,8,["name"])]),key:"0"}:void 0]),1032,["label","onClick"]))),128))])):w("",!0),v.value.length?(n(),B(t(ce),{key:1,options:v.value},{default:g(()=>[a(d,{icon:"more-horizontal"})]),_:1},8,["options"])):w("",!0),p.value.length?(n(),m("div",Gn,[(n(!0),m(F,null,O(p.value,c=>(n(),m("div",{key:c.label},[a(t(ce),{options:c.action},{default:g(({open:h})=>[a(d,{label:c.label},{suffix:g(()=>[a(l,{name:h?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label"])]),_:2},1032,["options"])]))),128))])):w("",!0)],64)}}},Xn={class:"flex flex-col"},Qn={key:1},eo={key:1,class:"flex h-screen overflow-hidden"},to={class:"flex flex-1 flex-col"},lo={class:"flex items-center justify-between border-b py-1 pr-2.5"},no=o("span",{class:"pl-6 text-lg font-semibold"},"Activity",-1),oo=o("h3",null,"Rename",-1),$o=H({__name:"TicketAgent",props:{ticketId:{type:String,required:!0}},setup(e){const i=ot(),{getUser:f}=Be(),p=k(null),v=k(null),r=k(null),u=k(!1),l=e;let d=be("ticket_agent",{showAllActivity:!0});const c=k(d.value.showAllActivity),h=k(!1),M=k(!1),_=N({url:"helpdesk.helpdesk.doctype.hd_ticket.api.get_one",cache:["Ticket",l.ticketId],auto:!0,params:{name:l.ticketId},transform:C=>{C._assign&&(C.assignees=JSON.parse(C._assign).map(s=>({name:s,image:f(s).user_image,label:f(s).full_name})))},onSuccess:C=>{r.value=C.subject,We(C,{doc:C})}}),E=L(()=>{let C=[{label:"Tickets",route:{name:"TicketsAgent"}}];return C.push({label:_.data?.subject,route:{name:"TicketAgent"}}),C});Ae(()=>c.value,C=>{d.value.showAllActivity=C});const y=L(()=>i.options.map(C=>({label:C,value:C,onClick:()=>b("status",C),icon:()=>X(we,{class:i.textColorMap[C]})}))),I=L(()=>{const C=_.data.communications.map(x=>({type:"email",key:x.creation,sender:{name:x.user.email,full_name:x.user.name},to:x.recipients,cc:x.cc,bcc:x.bcc,creation:x.creation,subject:x.subject,attachments:x.attachments,content:x.content})),s=_.data.comments.map(x=>({name:x.name,type:"comment",key:x.creation,commentedBy:x.commented_by,commenter:x.user.name,creation:x.creation,content:x.content}));if(!c.value)return[...C,...s].sort((x,R)=>new Date(x.creation)-new Date(R.creation));const j=[..._.data.history,..._.data.views].map(x=>({type:"history",key:x.creation,content:x.action?x.action:"viewed this",creation:x.creation,user:x.user.name+" "})),$=[...C,...s,...j].sort((x,R)=>new Date(x.creation)-new Date(R.creation)),q=[];let V=0;for(;V<$.length;){const x=$[V];if(x.type==="history"){x.relatedActivities=[];for(let R=V+1;R<$.length+1;R++){const W=$[R];if(W&&W.type==="history")x.relatedActivities.push(W);else{q.push(x),V=R-1;break}}}else q.push(x);V++}return q});function b(C,s){u.value=!0,N({url:"frappe.client.set_value",params:{doctype:"HD Ticket",name:l.ticketId,fieldname:C,value:s},auto:!0,onSuccess:()=>{u.value=!1,_.reload(),le({title:"Ticket updated",icon:"check",iconClasses:"text-green-600"})},onError:j=>{u.value=!1;const $=j.messages&&j.messages.length>0?j.messages[0]:"Failed to update ticket";le({title:$,icon:"x",iconClasses:"text-red-600"})}})}return Se(()=>{document.title=l.ticketId}),Ge(()=>{document.title="Helpdesk"}),(C,s)=>{const j=Jn,$=A("FeatherIcon"),q=A("Button");return n(),m("div",Xn,[t(_).data?(n(),B(t(tt),{key:0},{"left-header":g(()=>[a(t(Je),{items:E.value},null,8,["items"])]),"right-header":g(()=>[t(_).data._customActions?(n(),B(j,{key:0,actions:t(_).data._customActions},null,8,["actions"])):w("",!0),t(_).data.assignees?.length?(n(),m("div",Qn,[(n(),B(he(t(_).data.assignees.length==1?"Button":"div"),null,{default:g(()=>[a(t(et),{avatars:t(_).data.assignees,onClick:s[0]||(s[0]=V=>h.value=!0)},null,8,["avatars"])]),_:1}))])):(n(),m("button",{key:2,class:"rounded bg-gray-100 px-2 py-1.5 text-base text-gray-800",onClick:s[1]||(s[1]=V=>h.value=!0)}," Assign ")),a(t(ce),{options:y.value},{default:g(({open:V})=>[a(q,{label:t(_).data.status},{prefix:g(()=>[a(t(we),{class:z(t(i).textColorMap[t(_).data.status])},null,8,["class"])]),suffix:g(()=>[a($,{name:V?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label"])]),_:1},8,["options"])]),_:1})):w("",!0),t(_).data?(n(),m("div",eo,[o("div",to,[o("div",lo,[no,a(t(Qe),{modelValue:c.value,"onUpdate:modelValue":s[2]||(s[2]=V=>c.value=V),size:"sm",label:"Show all activity"},null,8,["modelValue"])]),a(t(dn),{ref_key:"ticketAgentActivitiesRef",ref:p,activities:I.value,onUpdate:s[3]||(s[3]=()=>{t(_).reload()}),"onEmail:reply":s[4]||(s[4]=V=>{v.value.replyToEmail(V)})},null,8,["activities"]),a(t(ml),{ref_key:"communicationAreaRef",ref:v,modelValue:t(_).data,"onUpdate:modelValue":s[5]||(s[5]=V=>t(_).data=V),"to-emails":[t(_).data.raised_by],"cc-emails":[],"bcc-emails":[],onUpdate:s[6]||(s[6]=()=>{t(_).reload(),p.value.scrollToLatestActivity()})},null,8,["modelValue","to-emails"])]),a(t(Yn),{ticket:t(_).data,onUpdate:s[7]||(s[7]=({field:V,value:x})=>b(V,x)),"onEmail:open":s[8]||(s[8]=V=>v.value.toggleEmailBox())},null,8,["ticket"])])):w("",!0),t(_).data?(n(),B(t(Ql),{key:2,modelValue:h.value,"onUpdate:modelValue":s[9]||(s[9]=V=>h.value=V),assignees:t(_).data.assignees,docname:e.ticketId,doctype:"HD Ticket",onUpdate:s[10]||(s[10]=()=>{t(_).reload()})},null,8,["modelValue","assignees","docname"])):w("",!0),a(t(Ve),{modelValue:M.value,"onUpdate:modelValue":s[14]||(s[14]=V=>M.value=V)},{"body-title":g(()=>[oo]),"body-content":g(()=>[a(t(ue),{modelValue:r.value,"onUpdate:modelValue":s[11]||(s[11]=V=>r.value=V),type:"text",size:"sm",variant:"subtle",disabled:!1,label:"New Subject"},null,8,["modelValue"])]),actions:g(()=>[a(q,{variant:"solid",disabled:!r.value,loading:u.value,onClick:s[12]||(s[12]=()=>{b("subject",r.value),M.value=!1})},{default:g(()=>[re(" Confirm ")]),_:1},8,["disabled","loading"]),a(q,{class:"ml-2",onClick:s[13]||(s[13]=V=>M.value=!1)},{default:g(()=>[re(" Close ")]),_:1})]),_:1},8,["modelValue"])])}}});export{$o as default};
//# sourceMappingURL=TicketAgent-fd9549dd.js.map
