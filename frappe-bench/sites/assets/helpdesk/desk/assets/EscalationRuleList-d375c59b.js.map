{"version":3,"file":"EscalationRuleList-d375c59b.js","sources":["../../../../desk/src/pages/desk/escalation/EscalationRuleDialogFieldList.vue","../../../../desk/src/pages/desk/escalation/EscalationRuleDialog.vue","../../../../desk/src/pages/desk/escalation/EscalationRuleList.vue"],"sourcesContent":["<template>\n  <div class=\"space-y-2\">\n    <div class=\"text-lg font-medium text-gray-900\">{{ title }}</div>\n    <div class=\"flex flex-wrap items-center gap-2 text-base\">\n      <div\n        v-for=\"(item, index) in items\"\n        :key=\"item.key\"\n        class=\"flex items-center gap-2\"\n      >\n        <div class=\"text-gray-800\">{{ item.label }}</div>\n        <SearchComplete\n          placeholder=\"Any\"\n          :doctype=\"item.doctype\"\n          :value=\"doc[item.key]\"\n          @change=\"(v) => onChange(item.key, v.value)\"\n        />\n        <span v-if=\"index + 1 < items.length\" class=\"text-gray-600\"> and </span>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { toRef } from \"vue\";\nimport SearchComplete from \"@/components/SearchComplete.vue\";\n\ntype Item = {\n  label: string;\n  doctype: string;\n  key: string;\n};\n\nconst props = defineProps({\n  title: {\n    type: String,\n    required: true,\n  },\n  items: {\n    type: Array<Item>,\n    required: true,\n  },\n  doc: {\n    type: Object,\n    required: true,\n  },\n});\n\nconst emit = defineEmits<{\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  (event: \"update:doc\", value: any): void;\n}>();\n\nconst doc = toRef(props, \"doc\");\n\nfunction onChange(key: string, value: string) {\n  emit(\"update:doc\", {\n    ...doc.value,\n    [key]: value,\n  });\n}\n</script>\n","<template>\n  <Dialog :options=\"options\">\n    <template #body-content>\n      <div class=\"space-y-4\">\n        <EscalationRuleDialogFieldList\n          v-model:doc=\"doc\"\n          title=\"Criteria\"\n          :items=\"criteria\"\n        />\n        <EscalationRuleDialogFieldList\n          v-model:doc=\"doc\"\n          title=\"Actions\"\n          :items=\"actions\"\n        />\n      </div>\n    </template>\n  </Dialog>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from \"vue\";\nimport { createResource, createDocumentResource, Dialog } from \"frappe-ui\";\nimport { createToast } from \"@/utils\";\nimport { useError } from \"@/composables/error\";\nimport EscalationRuleDialogFieldList from \"./EscalationRuleDialogFieldList.vue\";\n\nconst props = defineProps({\n  name: {\n    type: String,\n    required: true,\n  },\n});\n\nconst rule = createDocumentResource({\n  doctype: \"HD Escalation Rule\",\n  name: props.name || 747,\n  fields: [\"name\", \"priority\", \"team\", \"to_team\", \"to_agent\", \"to_priority\"],\n  auto: true,\n  onError() {\n    rule.doc = {};\n  },\n  setValue: {\n    debounce: 3000,\n    onSuccess() {\n      createToast({\n        title: \"Rule updated\",\n        icon: \"check\",\n        iconClasses: \"text-green-500\",\n      });\n    },\n    onError: useError({ title: \"Error updating rule\" }),\n  },\n  delete: {\n    onSuccess() {\n      createToast({\n        title: \"Rule deleted\",\n        icon: \"check\",\n        iconClasses: \"text-green-500\",\n      });\n    },\n    onError: useError({ title: \"Error deleting rule\" }),\n  },\n});\n\nconst newRule = createResource({\n  url: \"frappe.client.insert\",\n  onSuccess(data) {\n    createToast({\n      title: \"Rule created\",\n      icon: \"check\",\n      iconClasses: \"text-green-500\",\n    });\n\n    rule.name = data.name;\n    rule.reload();\n  },\n  onError: useError({ title: \"Error creating rule\" }),\n});\n\nconst doc = computed({\n  get() {\n    return rule.doc || {};\n  },\n  set(doc) {\n    rule.doc = doc;\n  },\n});\nconst isNew = computed(() => !doc.value.name);\n\nfunction save() {\n  const d = {\n    is_enabled: doc.value.is_enabled,\n    priority: doc.value.priority,\n    team: doc.value.team,\n    ticket_type: doc.value.ticket_type,\n    to_agent: doc.value.to_agent,\n    to_priority: doc.value.to_priority,\n    to_team: doc.value.to_team,\n    to_ticket_type: doc.value.to_ticket_type,\n  };\n\n  if (doc.value.name) {\n    rule.setValue.submit(d);\n    return;\n  }\n\n  newRule.submit({\n    doc: {\n      doctype: \"HD Escalation Rule\",\n      ...d,\n    },\n  });\n}\n\nconst options = computed(() => ({\n  title: isNew.value ? \"New rule\" : \"Edit rule\",\n  actions: [\n    {\n      label: isNew.value ? \"Create\" : \"Save\",\n      theme: \"gray\",\n      variant: \"subtle\",\n      onClick: () => save(),\n    },\n    {\n      label: doc.value?.is_enabled ? \"Disable\" : \"Enable\",\n      theme: doc.value?.is_enabled ? \"red\" : \"green\",\n      variant: \"subtle\",\n      onClick: () =>\n        rule.setValue.submit({ is_enabled: !doc.value.is_enabled }),\n      hidden: isNew.value,\n    },\n    {\n      label: \"Delete\",\n      theme: \"red\",\n      variant: \"subtle\",\n      onClick: () => rule.delete.submit(),\n      hidden: isNew.value,\n    },\n  ].filter((action) => !action.hidden),\n}));\n\nconst criteria = [\n  {\n    label: \"Priority is\",\n    doctype: \"HD Ticket Priority\",\n    key: \"priority\",\n  },\n  {\n    label: \"Team is\",\n    doctype: \"HD Team\",\n    key: \"team\",\n  },\n  {\n    label: \"Ticket type is\",\n    doctype: \"HD Ticket Type\",\n    key: \"ticket_type\",\n  },\n];\n\nconst actions = [\n  {\n    label: \"Change priority to\",\n    doctype: \"HD Ticket Priority\",\n    key: \"to_priority\",\n  },\n  {\n    label: \"Change team to\",\n    doctype: \"HD Team\",\n    key: \"to_team\",\n  },\n  {\n    label: \"Change ticket type to\",\n    doctype: \"HD Ticket Type\",\n    key: \"to_ticket_type\",\n  },\n  {\n    label: \"Assign to\",\n    doctype: \"HD Agent\",\n    key: \"to_agent\",\n  },\n];\n</script>\n","<template>\n  <div class=\"flex flex-col\">\n    <PageTitle title=\"Escalation Rules\">\n      <template #right>\n        <Button\n          label=\"New rule\"\n          theme=\"gray\"\n          variant=\"solid\"\n          @click=\"openDialog(null)\"\n        >\n          <template #prefix>\n            <LucidePlus class=\"h-4 w-4\" />\n          </template>\n        </Button>\n      </template>\n    </PageTitle>\n    <ListView\n      :columns=\"columns\"\n      :resource=\"rules\"\n      class=\"mt-2.5\"\n      doctype=\"HD Escalation Rule\"\n    >\n      <template #is_enabled=\"{ data }\">\n        <Badge :theme=\"data.is_enabled ? 'green' : 'red'\" variant=\"subtle\">\n          {{ data.is_enabled ? \"Enabled\" : \"Disabled\" }}\n        </Badge>\n      </template>\n    </ListView>\n    <EscalationRuleDialog\n      v-if=\"showDialog\"\n      v-model=\"showDialog\"\n      :name=\"selectedRule\"\n    />\n  </div>\n</template>\n<script setup lang=\"ts\">\nimport { ref } from \"vue\";\nimport { usePageMeta, Badge } from \"frappe-ui\";\nimport { socket } from \"@/socket\";\nimport { createListManager } from \"@/composables/listManager\";\nimport { ListView } from \"@/components\";\nimport PageTitle from \"@/components/PageTitle.vue\";\nimport EscalationRuleDialog from \"./EscalationRuleDialog.vue\";\n\nconst showDialog = ref(false);\nconst selectedRule = ref(null);\nconst emptyMessage = \"No Escalation Rules Found\";\nconst columns = [\n  {\n    label: \"Priority\",\n    key: \"priority\",\n    width: \"w-64\",\n  },\n  {\n    label: \"Team\",\n    key: \"team\",\n    width: \"w-64\",\n  },\n  {\n    label: \"Ticket type\",\n    key: \"ticket_type\",\n    width: \"w-64\",\n  },\n  {\n    label: \"Status\",\n    key: \"is_enabled\",\n    width: \"w-20\",\n  },\n];\n\nconst rules = createListManager({\n  doctype: \"HD Escalation Rule\",\n  fields: [\"name\", \"priority\", \"team\", \"ticket_type\", \"is_enabled\"],\n  auto: true,\n  transform: (data) => {\n    for (const d of data) {\n      d.onClick = () => openDialog(d.name);\n    }\n    return data;\n  },\n});\n\nusePageMeta(() => {\n  return {\n    title: \"Escalation rules\",\n  };\n});\n\nfunction openDialog(rule: string | null) {\n  selectedRule.value = rule;\n  showDialog.value = true;\n}\n\nsocket.on(\"helpdesk:new-escalation-rule\", () => rules.reload());\nsocket.on(\"helpdesk:delete-escalation-rule\", () => rules.reload());\n</script>\n"],"names":["props","__props","emit","__emit","doc","toRef","onChange","key","value","rule","createDocumentResource","createToast","useError","newRule","createResource","data","computed","doc2","isNew","save","d","options","action","criteria","actions","showDialog","ref","selectedRule","columns","rules","createListManager","openDialog","usePageMeta","socket"],"mappings":"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"}