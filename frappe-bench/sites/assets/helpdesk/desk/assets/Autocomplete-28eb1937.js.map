{"version":3,"file":"Autocomplete-28eb1937.js","sources":["../../../../desk/src/components/SearchComplete.vue","../../../../desk/src/components/Autocomplete.vue"],"sourcesContent":["<template>\n  <Autocomplete\n    placeholder=\"Select an option\"\n    :options=\"options\"\n    :value=\"selection\"\n    @update:query=\"(q) => onUpdateQuery(q)\"\n    @change=\"\n      (v) => {\n        if (!resetInput) {\n          selection = v;\n        }\n        emit('change', v);\n      }\n    \"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport { Autocomplete } from \"@/components\";\nimport { createListResource } from \"frappe-ui\";\nimport { computed, ref } from \"vue\";\n\nconst emit = defineEmits([\"change\"]);\n\nconst props = defineProps({\n  value: {\n    type: String,\n    required: false,\n    default: \"\",\n  },\n  doctype: {\n    type: String,\n    required: true,\n  },\n  searchField: {\n    type: String,\n    required: false,\n    default: \"name\",\n  },\n  labelField: {\n    type: String,\n    required: false,\n    default: \"name\",\n  },\n  valueField: {\n    type: String,\n    required: false,\n    default: \"name\",\n  },\n  pageLength: {\n    type: Number,\n    required: false,\n    default: 100,\n  },\n  resetInput: {\n    type: Boolean,\n    required: false,\n    default: false,\n  },\n});\n\nconst r = createListResource({\n  doctype: props.doctype,\n  pageLength: props.pageLength,\n  auto: true,\n  fields: [props.labelField, props.searchField, props.valueField],\n  filters: {\n    [props.searchField]: [\"like\", `%${props.value}%`],\n  },\n  onSuccess: () => {\n    selection.value = props.value\n      ? options.value.find((o) => o.value === props.value)\n      : null;\n  },\n});\nconst options = computed(\n  () =>\n    r.data?.map((result) => ({\n      label: result[props.labelField],\n      value: result[props.valueField],\n    })) || []\n);\nconst selection = ref(null);\n\nfunction onUpdateQuery(query: string) {\n  r.update({\n    filters: {\n      [props.searchField]: [\"like\", `%${query}%`],\n    },\n  });\n\n  r.reload();\n}\n</script>\n","<template>\n  <Combobox v-slot=\"{ open: isComboboxOpen }\" v-model=\"selectedValue\" nullable>\n    <Popover v-model:show=\"showOptions\" class=\"w-full\">\n      <template #target=\"{ open: openPopover, togglePopover }\">\n        <slot name=\"target\" v-bind=\"{ open: openPopover, togglePopover }\">\n          <div class=\"w-full\">\n            <button\n              class=\"flex w-full items-center justify-between focus:outline-none\"\n              :class=\"inputClasses\"\n              @click=\"() => togglePopover()\"\n            >\n              <div class=\"flex items-center\">\n                <slot name=\"prefix\" />\n                <span\n                  v-if=\"selectedValue\"\n                  class=\"overflow-hidden text-ellipsis whitespace-nowrap text-base leading-5\"\n                >\n                  {{ displayValue(selectedValue) }}\n                </span>\n                <span v-else class=\"text-base leading-5 text-gray-500\">\n                  {{ placeholder || \"\" }}\n                </span>\n              </div>\n              <FeatherIcon\n                name=\"chevron-down\"\n                class=\"h-4 w-4 text-gray-600\"\n                aria-hidden=\"true\"\n              />\n            </button>\n          </div>\n        </slot>\n      </template>\n      <template #body=\"{ isOpen }\">\n        <div v-show=\"isOpen\">\n          <div class=\"mt-1 rounded-lg bg-white py-1 text-base shadow-2xl\">\n            <div class=\"relative px-1.5 pt-0.5\">\n              <ComboboxInput\n                ref=\"search\"\n                class=\"form-input w-full\"\n                type=\"text\"\n                :value=\"query\"\n                autocomplete=\"off\"\n                placeholder=\"Search\"\n                @change=\"\n                  (e) => {\n                    query = e.target.value;\n                  }\n                \"\n              />\n              <button\n                class=\"absolute right-1.5 inline-flex h-7 w-7 items-center justify-center\"\n                @click=\"selectedValue = null\"\n              >\n                <FeatherIcon name=\"x\" class=\"w-4\" />\n              </button>\n            </div>\n            <ComboboxOptions\n              class=\"my-1 max-h-[12rem] overflow-y-auto px-1.5\"\n              static\n            >\n              <div\n                v-for=\"group in groups\"\n                v-show=\"group.items.length > 0\"\n                :key=\"group.key\"\n                class=\"mt-1.5\"\n              >\n                <div\n                  v-if=\"group.group && !group.hideLabel\"\n                  class=\"px-2.5 py-1.5 text-sm font-medium text-gray-500\"\n                >\n                  {{ group.group }}\n                </div>\n                <ComboboxOption\n                  v-for=\"option in group.items\"\n                  :key=\"option.value\"\n                  v-slot=\"{ active, selected }\"\n                  as=\"template\"\n                  :value=\"option\"\n                >\n                  <li\n                    :class=\"[\n                      'flex items-center rounded px-2.5 py-1.5 text-base',\n                      { 'bg-gray-100': active },\n                    ]\"\n                  >\n                    <slot\n                      name=\"item-prefix\"\n                      v-bind=\"{ active, selected, option }\"\n                    />\n                    <slot\n                      name=\"item-label\"\n                      v-bind=\"{ active, selected, option }\"\n                    >\n                      {{ option.label }}\n                    </slot>\n                  </li>\n                </ComboboxOption>\n              </div>\n              <li\n                v-if=\"groups.length == 0\"\n                class=\"mt-1.5 rounded-md px-2.5 py-1.5 text-base text-gray-600\"\n              >\n                No results found\n              </li>\n            </ComboboxOptions>\n            <div v-if=\"slots.footer\" class=\"border-t p-1.5 pb-0.5\">\n              <slot\n                name=\"footer\"\n                v-bind=\"{ value: search?.el._value, close }\"\n              ></slot>\n            </div>\n          </div>\n        </div>\n      </template>\n    </Popover>\n  </Combobox>\n</template>\n\n<script setup>\nimport {\n  Combobox,\n  ComboboxInput,\n  ComboboxOptions,\n  ComboboxOption,\n} from \"@headlessui/vue\";\nimport { Popover, Button, FeatherIcon } from \"frappe-ui\";\nimport { ref, computed, useAttrs, useSlots, watch, nextTick } from \"vue\";\n\nconst props = defineProps({\n  modelValue: {\n    type: String,\n    default: \"\",\n  },\n  options: {\n    type: Array,\n    default: () => [],\n  },\n  size: {\n    type: String,\n    default: \"md\",\n  },\n  variant: {\n    type: String,\n    default: \"subtle\",\n  },\n  placeholder: {\n    type: String,\n    default: \"\",\n  },\n  disabled: {\n    type: Boolean,\n    default: false,\n  },\n  filterable: {\n    type: Boolean,\n    default: true,\n  },\n});\nconst emit = defineEmits([\"update:modelValue\", \"update:query\", \"change\"]);\n\nconst query = ref(\"\");\nconst showOptions = ref(false);\nconst search = ref(null);\n\nconst attrs = useAttrs();\nconst slots = useSlots();\n\nconst valuePropPassed = computed(() => \"value\" in attrs);\n\nconst selectedValue = computed({\n  get() {\n    return valuePropPassed.value ? attrs.value : props.modelValue;\n  },\n  set(val) {\n    query.value = \"\";\n    if (val) {\n      showOptions.value = false;\n    }\n    emit(valuePropPassed.value ? \"change\" : \"update:modelValue\", val);\n  },\n});\n\nfunction close() {\n  showOptions.value = false;\n}\n\nconst groups = computed(() => {\n  if (!props.options || props.options.length == 0) return [];\n\n  let groups = props.options[0]?.group\n    ? props.options\n    : [{ group: \"\", items: props.options }];\n\n  return groups\n    .map((group, i) => {\n      return {\n        key: i,\n        group: group.group,\n        hideLabel: group.hideLabel || false,\n        items: props.filterable ? filterOptions(group.items) : group.items,\n      };\n    })\n    .filter((group) => group.items.length > 0);\n});\n\nfunction filterOptions(options) {\n  if (!query.value) {\n    return options;\n  }\n  return options.filter((option) => {\n    let searchTexts = [option.label, option.value];\n    return searchTexts.some((text) =>\n      (text || \"\").toString().toLowerCase().includes(query.value.toLowerCase())\n    );\n  });\n}\n\nfunction displayValue(option) {\n  if (typeof option === \"string\") {\n    let allOptions = groups.value.flatMap((group) => group.items);\n    let selectedOption = allOptions.find((o) => o.value === option);\n    return selectedOption?.label || option;\n  }\n  return option?.label;\n}\n\nwatch(query, (q) => {\n  emit(\"update:query\", q);\n});\n\nwatch(showOptions, (val) => {\n  if (val) {\n    nextTick(() => {\n      search.value.el.focus();\n    });\n  }\n});\n\nconst textColor = computed(() => {\n  return props.disabled ? \"text-gray-600\" : \"text-gray-800\";\n});\n\nconst inputClasses = computed(() => {\n  let sizeClasses = {\n    sm: \"text-base rounded h-7\",\n    md: \"text-base rounded h-8\",\n    lg: \"text-lg rounded-md h-10\",\n    xl: \"text-xl rounded-md h-10\",\n  }[props.size];\n\n  let paddingClasses = {\n    sm: \"py-1.5 px-2\",\n    md: \"py-1.5 px-2.5\",\n    lg: \"py-1.5 px-3\",\n    xl: \"py-1.5 px-3\",\n  }[props.size];\n\n  let variant = props.disabled ? \"disabled\" : props.variant;\n  let variantClasses = {\n    subtle:\n      \"border border-gray-100 bg-gray-100 placeholder-gray-500 hover:border-gray-200 hover:bg-gray-200 focus:bg-white focus:border-gray-500 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-gray-400\",\n    outline:\n      \"border border-gray-300 bg-white placeholder-gray-500 hover:border-gray-400 hover:shadow-sm focus:bg-white focus:border-gray-500 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-gray-400\",\n    disabled: [\n      \"border bg-gray-50 placeholder-gray-400\",\n      props.variant === \"outline\" ? \"border-gray-300\" : \"border-transparent\",\n    ],\n  }[variant];\n\n  return [\n    sizeClasses,\n    paddingClasses,\n    variantClasses,\n    textColor.value,\n    \"transition-colors w-full\",\n  ];\n});\n\ndefineExpose({ query });\n</script>\n"],"names":["emit","__emit","props","__props","r","createListResource","selection","options","o","computed","result","ref","onUpdateQuery","query","showOptions","search","attrs","useAttrs","slots","useSlots","valuePropPassed","selectedValue","val","close","groups","group","i","filterOptions","option","text","displayValue","watch","q","nextTick","textColor","inputClasses","sizeClasses","paddingClasses","variant","variantClasses","__expose"],"mappings":"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"}