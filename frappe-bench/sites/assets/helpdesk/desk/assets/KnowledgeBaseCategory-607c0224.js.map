{"version":3,"file":"KnowledgeBaseCategory-607c0224.js","sources":["../../../../desk/src/pages/knowledge-base/KnowledgeBaseCategory.vue"],"sourcesContent":["<template>\n  <div class=\"flex grow flex-col\">\n    <KnowledgeBaseCategoryHeader\n      :title=\"category.doc?.category_name\"\n      :description=\"category.doc?.description\"\n    >\n      <template #right>\n        <div class=\"space-x-2\">\n          <Button\n            label=\"Edit\"\n            theme=\"gray\"\n            variant=\"outline\"\n            @click=\"showEdit = !showEdit\"\n          >\n            <template #prefix>\n              <IconEdit class=\"h-4 w-4\" />\n            </template>\n          </Button>\n          <Button\n            label=\"Add new\"\n            theme=\"gray\"\n            variant=\"solid\"\n            @click=\"showNewSubCategory = !showNewSubCategory\"\n          >\n            <template #prefix>\n              <IconPlus class=\"h-4 w-4\" />\n            </template>\n          </Button>\n        </div>\n      </template>\n    </KnowledgeBaseCategoryHeader>\n    <EmptyMessage\n      v-if=\"isEmpty(subCategories.data)\"\n      message=\"This category is empty\"\n    />\n    <div v-else class=\"gap-4.5 grid grid-cols-3 px-5\">\n      <HCard\n        v-for=\"c in subCategories.data\"\n        :key=\"c.name\"\n        :description=\"c.description\"\n        :title=\"c.category_name\"\n        class=\"w-full place-self-center\"\n        @click=\"toSubcategory(c.name)\"\n      >\n        <template #bottom>\n          <div class=\"text-base text-gray-600\">\n            {{ c.count_article ? c.count_article : \"No\" }}\n            {{ c.count_article > 1 ? \"articles\" : \"article\" }}\n          </div>\n        </template>\n      </HCard>\n    </div>\n    <Dialog v-model=\"showEdit\" :options=\"{ title: 'Edit' }\">\n      <template #body-content>\n        <div class=\"space-y-4\">\n          <div class=\"space-y-2\">\n            <div class=\"text-xs text-gray-700\">Title</div>\n            <div class=\"flex items-center gap-2\">\n              <KnowledgeBaseIconSelector\n                :icon=\"newCategoryIcon || category.doc?.icon\"\n                @select=\"(icon) => (newCategoryIcon = icon)\"\n              />\n              <FormControl\n                v-model=\"category.doc.category_name\"\n                placeholder=\"A brief guide\"\n                type=\"text\"\n              />\n            </div>\n          </div>\n          <div class=\"space-y-2\">\n            <div class=\"text-xs text-gray-700\">Description</div>\n            <FormControl\n              v-model=\"category.doc.description\"\n              placeholder=\"A short description\"\n              type=\"textarea\"\n            />\n          </div>\n          <Button\n            class=\"w-full\"\n            label=\"Save\"\n            theme=\"gray\"\n            variant=\"solid\"\n            @click=\"saveCategory\"\n          />\n        </div>\n      </template>\n    </Dialog>\n    <Dialog\n      v-model=\"showNewSubCategory\"\n      :options=\"{ title: 'New Sub category' }\"\n    >\n      <template #body-content>\n        <form @submit.prevent=\"newSubCategory.submit\">\n          <div class=\"space-y-4\">\n            <FormControl\n              v-model=\"newSubCategoryName\"\n              type=\"text\"\n              label=\"Name\"\n              placeholder=\"Name\"\n            />\n            <FormControl\n              v-model=\"newSubCategoryDescription\"\n              type=\"textarea\"\n              label=\"Description\"\n              placeholder=\"Description\"\n            />\n            <Button\n              :disabled=\"isEmpty(newSubCategoryName)\"\n              class=\"w-full\"\n              label=\"Create\"\n              theme=\"gray\"\n              variant=\"solid\"\n            />\n          </div>\n        </form>\n      </template>\n    </Dialog>\n  </div>\n</template>\n<script setup lang=\"ts\">\nimport { ref, toRef } from \"vue\";\nimport { useRouter } from \"vue-router\";\nimport {\n  createResource,\n  createDocumentResource,\n  debounce,\n  Button as Button,\n  Dialog,\n  FormControl,\n} from \"frappe-ui\";\nimport { isEmpty } from \"lodash\";\nimport { AGENT_PORTAL_KNOWLEDGE_BASE_SUB_CATEGORY } from \"@/router\";\nimport { createToast } from \"@/utils\";\nimport { createListManager } from \"@/composables/listManager\";\nimport { useError } from \"@/composables/error\";\nimport { HCard } from \"@/components\";\nimport KnowledgeBaseCategoryHeader from \"./KnowledgeBaseCategoryHeader.vue\";\nimport KnowledgeBaseIconSelector from \"./KnowledgeBaseIconSelector.vue\";\nimport EmptyMessage from \"@/components/EmptyMessage.vue\";\nimport IconEdit from \"~icons/lucide/edit-3\";\nimport IconPlus from \"~icons/lucide/plus\";\n\nconst props = defineProps({\n  categoryId: {\n    type: String,\n    required: true,\n  },\n});\n\nconst router = useRouter();\nconst categoryId = toRef(props, \"categoryId\");\nconst newSubCategoryName = ref(\"\");\nconst newSubCategoryDescription = ref(\"\");\nconst showNewSubCategory = ref(false);\nconst newCategoryName = ref(\"\");\nconst newCategoryDescription = ref(\"\");\nconst newCategoryIcon = ref(\"\");\nconst showEdit = ref(false);\n\nconst category = createDocumentResource({\n  doctype: \"HD Article Category\",\n  name: categoryId.value,\n  auto: true,\n  setValue: {\n    onSuccess() {\n      createToast({\n        title: \"Category updated\",\n        icon: \"check\",\n        iconClasses: \"text-green-500\",\n      });\n    },\n    onError: useError({ title: \"Error updating category\" }),\n  },\n});\n\nconst saveCategory = debounce(\n  () =>\n    category.setValue.submit({\n      category_name: newCategoryName.value || category.doc.category_name,\n      description: newCategoryDescription.value || category.doc.description,\n      icon: newCategoryIcon.value || category.doc.icon,\n    }),\n  500\n);\n\nconst newSubCategory = createResource({\n  url: \"frappe.client.insert\",\n  debounce: 500,\n  makeParams() {\n    return {\n      doc: {\n        doctype: \"HD Article Category\",\n        category_name: newSubCategoryName.value,\n        description: newSubCategoryDescription.value,\n        parent_category: category.doc?.name,\n      },\n    };\n  },\n  validate(params) {\n    if (isEmpty(params.doc.category_name)) {\n      return \"Category name is required\";\n    }\n  },\n  onSuccess() {\n    showNewSubCategory.value = false;\n    subCategories.reload();\n  },\n  onError: useError({ title: \"Error creating sub category\" }),\n});\n\nconst subCategories = createListManager({\n  doctype: \"HD Article Category\",\n  filters: {\n    parent_category: categoryId.value,\n  },\n  auto: true,\n});\n\nfunction toSubcategory(subCategoryId: string) {\n  router.push({\n    name: AGENT_PORTAL_KNOWLEDGE_BASE_SUB_CATEGORY,\n    params: {\n      subCategoryId,\n    },\n  });\n}\n</script>\n"],"names":["props","__props","router","useRouter","categoryId","toRef","newSubCategoryName","ref","newSubCategoryDescription","showNewSubCategory","newCategoryName","newCategoryDescription","newCategoryIcon","showEdit","category","createDocumentResource","createToast","useError","saveCategory","debounce","newSubCategory","createResource","params","isEmpty","subCategories","createListManager","toSubcategory","subCategoryId","AGENT_PORTAL_KNOWLEDGE_BASE_SUB_CATEGORY"],"mappings":"wmDA8IA,MAAAA,EAAAC,EAOAC,EAAAC,IACAC,EAAAC,EAAAL,EAAA,YAAA,EACAM,EAAAC,EAAA,EAAA,EACAC,EAAAD,EAAA,EAAA,EACAE,EAAAF,EAAA,EAAA,EACAG,EAAAH,EAAA,EAAA,EACAI,EAAAJ,EAAA,EAAA,EACAK,EAAAL,EAAA,EAAA,EACAM,EAAAN,EAAA,EAAA,EAEAO,EAAAC,EAAA,CAAwC,QAAA,sBAC7B,KAAAX,EAAA,MACQ,KAAA,GACX,SAAA,CACI,WAAA,CAENY,EAAA,CAAY,MAAA,mBACH,KAAA,QACD,YAAA,gBACO,CAAA,CACd,EACH,QAAAC,EAAA,CAAA,MAAA,yBAAA,CAAA,CACsD,CACxD,CAAA,EAGFC,EAAAC,EAAqB,IAAAL,EAAA,SAAA,OAAA,CAEQ,cAAAJ,EAAA,OAAAI,EAAA,IAAA,cAC8B,YAAAH,EAAA,OAAAG,EAAA,IAAA,YACK,KAAAF,EAAA,OAAAE,EAAA,IAAA,IACd,CAAA,EAC7C,GACH,EAGFM,EAAAC,EAAA,CAAsC,IAAA,uBAC/B,SAAA,IACK,YAAA,CAER,MAAA,CAAO,IAAA,CACA,QAAA,sBACM,cAAAf,EAAA,MACyB,YAAAE,EAAA,MACK,gBAAAM,EAAA,KAAA,IACR,CACjC,CACF,EACF,SAAAQ,EAAA,CAEE,GAAAC,UAAAD,EAAA,IAAA,aAAA,EACE,MAAA,2BACF,EACF,WAAA,CAEEb,EAAA,MAAA,GACAe,EAAA,OAAA,CAAqB,EACvB,QAAAP,EAAA,CAAA,MAAA,6BAAA,CAAA,CAC0D,CAAA,EAG5DO,EAAAC,EAAA,CAAwC,QAAA,sBAC7B,QAAA,CACA,gBAAArB,EAAA,KACqB,EAC9B,KAAA,EACM,CAAA,EAGR,SAAAsB,EAAAC,EAAA,CACEzB,EAAA,KAAA,CAAY,KAAA0B,EACJ,OAAA,CACE,cAAAD,CACN,CACF,CAAA,CACD"}