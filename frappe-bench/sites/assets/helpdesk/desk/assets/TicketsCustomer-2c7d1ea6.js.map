{"version":3,"file":"TicketsCustomer-2c7d1ea6.js","sources":["../../../../desk/src/pages/TicketsCustomer.vue"],"sourcesContent":["<template>\n  <div class=\"flex flex-col\">\n    <PageTitle title=\"Tickets\">\n      <template #right>\n        <div class=\"flex gap-2\">\n          <div\n            class=\"flex items-center justify-between text-base text-gray-700\"\n          >\n            <div class=\"flex gap-4\">\n              <Dropdown :options=\"dropdownOptions\">\n                <template #default=\"{ open }\">\n                  <Button\n                    :label=\"dropdownTitle\"\n                    :icon-right=\"open ? 'chevron-up' : 'chevron-down'\"\n                    theme=\"gray\"\n                    variant=\"outline\"\n                  />\n                </template>\n              </Dropdown>\n            </div>\n          </div>\n          <RouterLink\n            v-if=\"!configStore.preferKnowledgeBase\"\n            :to=\"{ name: CUSTOMER_PORTAL_NEW_TICKET }\"\n          >\n            <Button\n              class=\"bg-gray-900 text-white hover:bg-gray-800\"\n              label=\"New ticket\"\n              icon-right=\"plus\"\n            />\n          </RouterLink>\n        </div>\n      </template>\n    </PageTitle>\n    <ListView\n      :columns=\"columns\"\n      :resource=\"tickets\"\n      class=\"mt-2.5\"\n      doctype=\"HD Ticket\"\n    >\n      <template #status=\"{ data }\">\n        <Badge\n          :label=\"transformStatus(data.status)\"\n          :theme=\"ticketStatusStore.colorMap[data.status]\"\n          variant=\"outline\"\n        />\n      </template>\n      <template #response_by=\"{ data }\">\n        <span v-if=\"data.response_by\">\n          <Badge\n            v-if=\"\n              data.first_responded_on &&\n              dayjs(data.first_responded_on).isBefore(data.response_by)\n            \"\n            label=\"Fulfilled\"\n            theme=\"green\"\n            variant=\"outline\"\n          />\n          <Badge\n            v-else-if=\"dayjs(data.first_responded_on).isAfter(data.response_by)\"\n            label=\"Failed\"\n            theme=\"red\"\n            variant=\"outline\"\n          />\n          <Tooltip v-else :text=\"dayjs(data.response_by).long()\">\n            {{ dayjs.tz(data.response_by).fromNow() }}\n          </Tooltip>\n        </span>\n      </template>\n      <template #resolution_by=\"{ data }\">\n        <span v-if=\"data.resolution_by\">\n          <Badge\n            v-if=\"\n              data.resolution_date &&\n              dayjs(data.resolution_date).isBefore(data.resolution_by)\n            \"\n            label=\"Fulfilled\"\n            theme=\"green\"\n            variant=\"outline\"\n          />\n          <Badge\n            v-else-if=\"dayjs(data.resolution_date).isAfter(data.resolution_by)\"\n            label=\"Failed\"\n            theme=\"red\"\n            variant=\"outline\"\n          />\n          <Tooltip v-else :text=\"dayjs(data.resolution_by).long()\">\n            {{ dayjs.tz(data.resolution_by).fromNow() }}\n          </Tooltip>\n        </span>\n      </template>\n      <template #creation=\"{ data }\">\n        {{ dayjs.tz(data.creation).fromNow() }}\n      </template>\n    </ListView>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref } from \"vue\";\nimport { Dropdown, Tooltip } from \"frappe-ui\";\nimport { dayjs } from \"@/dayjs\";\nimport { useConfigStore } from \"@/stores/config\";\nimport { useTicketStatusStore } from \"@/stores/ticketStatus\";\nimport { createListManager } from \"@/composables/listManager\";\nimport { CUSTOMER_PORTAL_TICKET, CUSTOMER_PORTAL_NEW_TICKET } from \"@/router\";\nimport { ListView } from \"@/components\";\nimport PageTitle from \"@/components/PageTitle.vue\";\n\nconst configStore = useConfigStore();\nconst ticketStatusStore = useTicketStatusStore();\nconst columns = [\n  {\n    label: \"#\",\n    key: \"name\",\n    width: \"w-12\",\n  },\n  {\n    label: \"Subject\",\n    key: \"subject\",\n    width: \"w-96\",\n  },\n  {\n    label: \"Status\",\n    key: \"status\",\n    width: \"w-32\",\n  },\n  {\n    label: \"Priority\",\n    key: \"priority\",\n    width: \"w-32\",\n  },\n  {\n    label: \"First Response\",\n    key: \"response_by\",\n    width: \"w-32\",\n  },\n  {\n    label: \"Resolution\",\n    key: \"resolution_by\",\n    width: \"w-32\",\n  },\n  {\n    label: \"Created\",\n    key: \"creation\",\n    width: \"w-32\",\n  },\n];\n\nconst tickets = createListManager({\n  doctype: \"HD Ticket\",\n  pageLength: 20,\n  fields: [\n    \"name\",\n    \"creation\",\n    \"subject\",\n    \"status\",\n    \"priority\",\n    \"response_by\",\n    \"resolution_by\",\n    \"first_responded_on\",\n    \"resolution_date\",\n  ],\n  auto: true,\n  transform: (data) => {\n    for (const d of data) {\n      d.onClick = {\n        name: CUSTOMER_PORTAL_TICKET,\n        params: {\n          ticketId: d.name,\n        },\n      };\n    }\n  },\n});\n\nconst ACTIVE_TICKET_TYPES = [\"Open\", \"Replied\"];\nconst dropdownTitle = ref(\"All tickets\");\nconst dropdownOptions = [\n  {\n    label: \"All tickets\",\n    onClick() {\n      filter(\"All tickets\", { status: undefined });\n    },\n  },\n  {\n    label: \"Open tickets\",\n    onClick() {\n      filter(\"Open tickets\", { status: [\"in\", ACTIVE_TICKET_TYPES] });\n    },\n  },\n  {\n    label: \"Closed tickets\",\n    onClick() {\n      filter(\"Closed tickets\", { status: [\"not in\", ACTIVE_TICKET_TYPES] });\n    },\n  },\n];\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nfunction filter(title: string, filters: Record<string, any>) {\n  tickets.update({\n    ...tickets,\n    filters: {\n      ...tickets.filters,\n      ...filters,\n    },\n  });\n  tickets.reload();\n  dropdownTitle.value = title;\n}\n\nfunction transformStatus(status: string) {\n  switch (status) {\n    case \"Replied\":\n      return \"Awaiting reply\";\n    default:\n      return status;\n  }\n}\n</script>\n"],"names":["configStore","useConfigStore","ticketStatusStore","useTicketStatusStore","columns","tickets","createListManager","data","d","CUSTOMER_PORTAL_TICKET","ACTIVE_TICKET_TYPES","dropdownTitle","ref","dropdownOptions","filter","title","filters","transformStatus","status"],"mappings":"u3BA6GA,MAAAA,EAAAC,IACAC,EAAAC,IACAC,EAAA,CAAgB,CACd,MAAA,IACS,IAAA,OACF,MAAA,MACE,EACT,CACA,MAAA,UACS,IAAA,UACF,MAAA,MACE,EACT,CACA,MAAA,SACS,IAAA,SACF,MAAA,MACE,EACT,CACA,MAAA,WACS,IAAA,WACF,MAAA,MACE,EACT,CACA,MAAA,iBACS,IAAA,cACF,MAAA,MACE,EACT,CACA,MAAA,aACS,IAAA,gBACF,MAAA,MACE,EACT,CACA,MAAA,UACS,IAAA,WACF,MAAA,MACE,CACT,EAGFC,EAAAC,EAAA,CAAkC,QAAA,YACvB,WAAA,GACG,OAAA,CACJ,OACN,WACA,UACA,SACA,WACA,cACA,gBACA,qBACA,iBACA,EACF,KAAA,GACM,UAAAC,GAAA,CAEJ,UAAAC,KAAAD,EACEC,EAAA,QAAA,CAAY,KAAAC,EACJ,OAAA,CACE,SAAAD,EAAA,IACM,CACd,CAEJ,CACF,CAAA,EAGFE,EAAA,CAAA,OAAA,SAAA,EACAC,EAAAC,EAAA,aAAA,EACAC,EAAA,CAAwB,CACtB,MAAA,cACS,SAAA,CAELC,EAAA,cAAA,CAAA,OAAA,MAAA,CAAA,CAA2C,CAC7C,EACF,CACA,MAAA,eACS,SAAA,CAELA,EAAA,eAAA,CAAA,OAAA,CAAA,KAAAJ,CAAA,CAAA,CAAA,CAA8D,CAChE,EACF,CACA,MAAA,iBACS,SAAA,CAELI,EAAA,iBAAA,CAAA,OAAA,CAAA,SAAAJ,CAAA,CAAA,CAAA,CAAoE,CACtE,CACF,EAIF,SAAAI,EAAAC,EAAAC,EAAA,CACEX,EAAA,OAAA,CAAe,GAAAA,EACV,QAAA,CACM,GAAAA,EAAA,QACI,GAAAW,CACR,CACL,CAAA,EAEFX,EAAA,OAAA,EACAM,EAAA,MAAAI,CAAsB,CAGxB,SAAAE,EAAAC,EAAA,CACE,OAAAA,EAAA,CAAgB,IAAA,UAEZ,MAAA,iBAAO,QAEP,OAAAA,CAAO,CACX"}